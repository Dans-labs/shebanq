<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Saving Queries on the BHSA (Hebrew Bible + ETCBC linguistics)
"><meta name=author content="Dirk Roorda"><link href=https://etcbs.github.io/shebanq/deploy/server/ rel=canonical><link rel=icon href=../../favicon.ico><meta name=generator content="mkdocs-1.2.3, mkdocs-material-7.3.4"><title>Server - SHEBANQ</title><link rel=stylesheet href=../../assets/stylesheets/main.db9e7362.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.3f5d1f46.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css></head> <body dir=ltr data-md-color-scheme data-md-color-primary=none data-md-color-accent=none> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#server class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=SHEBANQ class="md-header__button md-logo" aria-label=SHEBANQ data-md-component=logo> <img src=../../images/shebanq_logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> SHEBANQ </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Server </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/etcbc/shebanq/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> etcbc/shebanq </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=SHEBANQ class="md-nav__button md-logo" aria-label=SHEBANQ data-md-component=logo> <img src=../../images/shebanq_logo.png alt=logo> </a> SHEBANQ </label> <div class=md-nav__source> <a href=https://github.com/etcbc/shebanq/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> etcbc/shebanq </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Technical Home </a> </li> <li class=md-nav__item> <a href=../../news/ class=md-nav__link> News </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Client <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Client data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Client </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../client/ class=md-nav__link> Client </a> </li> <li class=md-nav__item> <a href=../../client/css/ class=md-nav__link> CSS organization </a> </li> <li class=md-nav__item> <a href=../../client/js/ class=md-nav__link> Javascript organization </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_4 type=checkbox id=__nav_3_4> <label class=md-nav__link for=__nav_3_4> Bymodule <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Bymodule data-md-level=2> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Bymodule </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../client/bymodule/ class=md-nav__link> About modules </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/chart/ class=md-nav__link> Chart </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/colorpicker/ class=md-nav__link> Colorpicker </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/diagnostics/ class=md-nav__link> Diagnostics </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/featuresettings/ class=md-nav__link> Featuresettings </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/helpers/ class=md-nav__link> Helpers </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/localstorage/ class=md-nav__link> Localstorage </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/main/ class=md-nav__link> Main </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/material/ class=md-nav__link> Material </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/materialcontent/ class=md-nav__link> Materialcontent </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/materialsettings/ class=md-nav__link> Materialsettings </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/message/ class=md-nav__link> Message </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/notes/ class=md-nav__link> Notes </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/notetree/ class=md-nav__link> Notetree </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/page/ class=md-nav__link> Page </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/queryrecent/ class=md-nav__link> Queryrecent </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/querytree/ class=md-nav__link> Querytree </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/select/ class=md-nav__link> Select </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/share/ class=md-nav__link> Share </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/sidebars/ class=md-nav__link> Sidebars </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/sidecontent/ class=md-nav__link> Sidecontent </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/sidesettings/ class=md-nav__link> Sidesettings </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/viewstate/ class=md-nav__link> Viewstate </a> </li> <li class=md-nav__item> <a href=../../client/bymodule/words/ class=md-nav__link> Words </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> Deploy <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Deploy data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Deploy </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../computer/ class=md-nav__link> Computer </a> </li> <li class=md-nav__item> <a href=../documentation/ class=md-nav__link> Documentation </a> </li> <li class=md-nav__item> <a href=../maintenance/ class=md-nav__link> Installation and maintenance </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Server <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Server </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#acknowledgements class=md-nav__link> Acknowledgements </a> </li> <li class=md-nav__item> <a href=#tools class=md-nav__link> Tools </a> </li> <li class=md-nav__item> <a href=#requirements class=md-nav__link> Requirements </a> <nav class=md-nav aria-label=Requirements> <ul class=md-nav__list> <li class=md-nav__item> <a href=#server_1 class=md-nav__link> Server </a> </li> <li class=md-nav__item> <a href=#local-computer class=md-nav__link> Local computer </a> <nav class=md-nav aria-label="Local computer"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the-_local-directory class=md-nav__link> The _local directory </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#the-scripts class=md-nav__link> The scripts </a> </li> <li class=md-nav__item> <a href=#the-situations class=md-nav__link> The situations </a> </li> <li class=md-nav__item> <a href=#the-scenarios class=md-nav__link> The scenarios </a> <nav class=md-nav aria-label="The scenarios"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#install-shebanq-on-a-new-server class=md-nav__link> Install SHEBANQ on a new server </a> <nav class=md-nav aria-label="Install SHEBANQ on a new server"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#situation-other-first-time class=md-nav__link> Situation Other (first time) </a> </li> <li class=md-nav__item> <a href=#other-migrating class=md-nav__link> Other (migrating) </a> </li> <li class=md-nav__item> <a href=#test class=md-nav__link> Test </a> </li> <li class=md-nav__item> <a href=#production-migrating class=md-nav__link> Production (migrating) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#update-shebanq-on-an-existing-server class=md-nav__link> Update SHEBANQ on an existing server </a> <nav class=md-nav aria-label="Update SHEBANQ on an existing server"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#shebanq-code-only class=md-nav__link> SHEBANQ code only </a> </li> <li class=md-nav__item> <a href=#a-version-of-the-static-data class=md-nav__link> A version of the static data </a> </li> <li class=md-nav__item> <a href=#emdros class=md-nav__link> Emdros </a> </li> <li class=md-nav__item> <a href=#web2py class=md-nav__link> Web2py </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#maintain-backups-of-dynamic-data class=md-nav__link> Maintain backups of dynamic data </a> <nav class=md-nav aria-label="Maintain backups of dynamic data"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#backup-dynamic-data class=md-nav__link> Backup dynamic data </a> </li> <li class=md-nav__item> <a href=#restore-dynamic-data class=md-nav__link> Restore dynamic data </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#import-massive-amounts-of-notes class=md-nav__link> Import massive amounts of notes </a> <nav class=md-nav aria-label="Import massive amounts of notes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#bulk-uploading-sets-of-notes class=md-nav__link> Bulk uploading sets of notes </a> </li> <li class=md-nav__item> <a href=#make-somebody-a-bulk-uploader class=md-nav__link> Make somebody a bulk uploader </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#trouble-shooting class=md-nav__link> Trouble shooting </a> <nav class=md-nav aria-label="Trouble shooting"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#selinux-violations class=md-nav__link> SELINUX violations </a> </li> <li class=md-nav__item> <a href=#database-permissions class=md-nav__link> Database permissions </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Elements <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Elements data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Elements </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../elements/ class=md-nav__link> Pages </a> </li> <li class=md-nav__item> <a href=../../elements/notespage/ class=md-nav__link> Notes pages </a> </li> <li class=md-nav__item> <a href=../../elements/queriespage/ class=md-nav__link> Queries pages </a> </li> <li class=md-nav__item> <a href=../../elements/sidebars/ class=md-nav__link> Sidebars </a> </li> <li class=md-nav__item> <a href=../../elements/textpages/ class=md-nav__link> Text pages </a> </li> <li class=md-nav__item> <a href=../../elements/wordspage/ class=md-nav__link> Words pages </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Server <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Server data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Server </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../server/ class=md-nav__link> Server </a> </li> <li class=md-nav__item> <a href=../../server/controllers/ class=md-nav__link> Controllers </a> </li> <li class=md-nav__item> <a href=../../server/models/ class=md-nav__link> Models </a> </li> <li class=md-nav__item> <a href=../../server/views/ class=md-nav__link> Views </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6_5 type=checkbox id=__nav_6_5> <label class=md-nav__link for=__nav_6_5> Bymodule <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Bymodule data-md-level=2> <label class=md-nav__title for=__nav_6_5> <span class="md-nav__icon md-icon"></span> Bymodule </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../server/bymodule/ class=md-nav__link> About modules </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/blang/ class=md-nav__link> Blang </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/boiler/ class=md-nav__link> Boiler </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/books/ class=md-nav__link> Books </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/caching/ class=md-nav__link> Caching </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/chart/ class=md-nav__link> Chart </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/check/ class=md-nav__link> Check </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/constants/ class=md-nav__link> Constants </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/csvdata/ class=md-nav__link> Csvdata </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/dbconfig/ class=md-nav__link> Dbconfig </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/helpers/ class=md-nav__link> Helpers </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/materials/ class=md-nav__link> Materials </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/mql/ class=md-nav__link> Mql </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/note/ class=md-nav__link> Note </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/notesave/ class=md-nav__link> Notesave </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/notesupload/ class=md-nav__link> Notesupload </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/notetree/ class=md-nav__link> Notetree </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/query/ class=md-nav__link> Query </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/querychapter/ class=md-nav__link> Querychapter </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/queryrecent/ class=md-nav__link> Queryrecent </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/querysave/ class=md-nav__link> Querysave </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/querytree/ class=md-nav__link> Querytree </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/record/ class=md-nav__link> Record </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/side/ class=md-nav__link> Side </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/urls/ class=md-nav__link> Urls </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/verse/ class=md-nav__link> Verse </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/versecontent/ class=md-nav__link> Versecontent </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/versescontent/ class=md-nav__link> Versescontent </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/viewdefs/ class=md-nav__link> Viewdefs </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/viewsettings/ class=md-nav__link> Viewsettings </a> </li> <li class=md-nav__item> <a href=../../server/bymodule/word/ class=md-nav__link> Word </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Solutions <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Solutions data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Solutions </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../solutions/bottlenecks/ class=md-nav__link> Bottlenecks </a> </li> <li class=md-nav__item> <a href=../../solutions/caching/ class=md-nav__link> Caching </a> </li> <li class=md-nav__item> <a href=../../solutions/todo/ class=md-nav__link> Todo </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> Tests <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tests data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Tests </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tests/ class=md-nav__link> Tests </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8_2 type=checkbox id=__nav_8_2> <label class=md-nav__link for=__nav_8_2> Bymodule <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Bymodule data-md-level=2> <label class=md-nav__title for=__nav_8_2> <span class="md-nav__icon md-icon"></span> Bymodule </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../tests/bymodule/ class=md-nav__link> About modules </a> </li> <li class=md-nav__item> <a href=../../tests/bymodule/__init__/ class=md-nav__link> init </a> </li> <li class=md-nav__item> <a href=../../tests/bymodule/conftest/ class=md-nav__link> Conftest </a> </li> <li class=md-nav__item> <a href=../../tests/bymodule/helpers/ class=md-nav__link> Helpers </a> </li> <li class=md-nav__item> <a href=../../tests/bymodule/test_queries/ class=md-nav__link> Test queries </a> </li> <li class=md-nav__item> <a href=../../tests/bymodule/test_words/ class=md-nav__link> Test words </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#acknowledgements class=md-nav__link> Acknowledgements </a> </li> <li class=md-nav__item> <a href=#tools class=md-nav__link> Tools </a> </li> <li class=md-nav__item> <a href=#requirements class=md-nav__link> Requirements </a> <nav class=md-nav aria-label=Requirements> <ul class=md-nav__list> <li class=md-nav__item> <a href=#server_1 class=md-nav__link> Server </a> </li> <li class=md-nav__item> <a href=#local-computer class=md-nav__link> Local computer </a> <nav class=md-nav aria-label="Local computer"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the-_local-directory class=md-nav__link> The _local directory </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#the-scripts class=md-nav__link> The scripts </a> </li> <li class=md-nav__item> <a href=#the-situations class=md-nav__link> The situations </a> </li> <li class=md-nav__item> <a href=#the-scenarios class=md-nav__link> The scenarios </a> <nav class=md-nav aria-label="The scenarios"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#install-shebanq-on-a-new-server class=md-nav__link> Install SHEBANQ on a new server </a> <nav class=md-nav aria-label="Install SHEBANQ on a new server"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#situation-other-first-time class=md-nav__link> Situation Other (first time) </a> </li> <li class=md-nav__item> <a href=#other-migrating class=md-nav__link> Other (migrating) </a> </li> <li class=md-nav__item> <a href=#test class=md-nav__link> Test </a> </li> <li class=md-nav__item> <a href=#production-migrating class=md-nav__link> Production (migrating) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#update-shebanq-on-an-existing-server class=md-nav__link> Update SHEBANQ on an existing server </a> <nav class=md-nav aria-label="Update SHEBANQ on an existing server"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#shebanq-code-only class=md-nav__link> SHEBANQ code only </a> </li> <li class=md-nav__item> <a href=#a-version-of-the-static-data class=md-nav__link> A version of the static data </a> </li> <li class=md-nav__item> <a href=#emdros class=md-nav__link> Emdros </a> </li> <li class=md-nav__item> <a href=#web2py class=md-nav__link> Web2py </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#maintain-backups-of-dynamic-data class=md-nav__link> Maintain backups of dynamic data </a> <nav class=md-nav aria-label="Maintain backups of dynamic data"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#backup-dynamic-data class=md-nav__link> Backup dynamic data </a> </li> <li class=md-nav__item> <a href=#restore-dynamic-data class=md-nav__link> Restore dynamic data </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#import-massive-amounts-of-notes class=md-nav__link> Import massive amounts of notes </a> <nav class=md-nav aria-label="Import massive amounts of notes"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#bulk-uploading-sets-of-notes class=md-nav__link> Bulk uploading sets of notes </a> </li> <li class=md-nav__item> <a href=#make-somebody-a-bulk-uploader class=md-nav__link> Make somebody a bulk uploader </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#trouble-shooting class=md-nav__link> Trouble shooting </a> <nav class=md-nav aria-label="Trouble shooting"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#selinux-violations class=md-nav__link> SELINUX violations </a> </li> <li class=md-nav__item> <a href=#database-permissions class=md-nav__link> Database permissions </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/etcbc/shebanq/edit/master/docs/deploy/server.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=server>Server<a class=headerlink href=#server title="Permanent link">&para;</a></h1> <p>This article describes the installation and maintenance of SHEBANQ of a secure RedHat Fedora linux server.</p> <h2 id=acknowledgements>Acknowledgements<a class=headerlink href=#acknowledgements title="Permanent link">&para;</a></h2> <p>Thanks to <a href=https://www.biblicalstudies.eu>Elia Fiore and his people</a> for installing SHEBANQ on RHEL/Centos/AlmaLinux/RockyLinux and giving essential feedback.</p> <div class="admonition hint"> <p class=admonition-title>Ubuntu</p> <p>If you prefer Ubuntu, that should be easier. You need to change a few things: <code>yum</code> becomes <code>apt-get</code>, the names of installation packages might be slightly different. You can leave out typical selinux commands such as <code>chcon</code> and <code>setsebool</code>. Various locations maybe a little bit different.</p> </div> <h2 id=tools>Tools<a class=headerlink href=#tools title="Permanent link">&para;</a></h2> <p>This repository contains a set of shell scripts to perform installation and maintenance tasks on SHEBANQ servers. It also has most of the assets needed for installation. The remaining assets are available through the <a href=https://github.com/etcbc/bhsa>BHSA</a> repository.</p> <div class="admonition caution"> <p class=admonition-title>Requirements</p> <p>Read first to the end of this document, and take note of the <strong>requirements</strong>.</p> </div> <p><a href=https://en.wikipedia.org/wiki/Security-Enhanced_Linux>SELINUX</a> might not be the most obvious choice to host SHEBANQ on, because it is considerably more difficult to work with than Ubuntu.</p> <p>However, there are a few key advantages you enjoy after the installation:</p> <ul> <li> <p><strong>prime security</strong></p> <p>You have SHEBANQ running on a top-notch secure system.</p> </li> <li> <p><strong>head-ache-free software updates</strong></p> <p>Much of supporting software (Python, MySQL, Apache) can be updated without the risk of breaking things, because the current versions of them are supported for an extra long time. Often, new security updates are back-ported to older versions, so that you can avoid upgrading to newer but incompatible versions.</p> </li> </ul> <p>The latter advantage is quite convenient for SHEBANQ, because the Emdros software is compiled against de MySQL libraries. So when MySQL is upgraded to a new version, Emdros has to be recompiled. And that is something we do not want to do too often.</p> <h2 id=requirements>Requirements<a class=headerlink href=#requirements title="Permanent link">&para;</a></h2> <h3 id=server_1>Server<a class=headerlink href=#server_1 title="Permanent link">&para;</a></h3> <p>The server on which SHEBANQ is installed is a <a href=https://en.wikipedia.org/wiki/Security-Enhanced_Linux>Security Enhanced Linux Server (SELINUX)</a>. You must be able to access this server by means of <a href=https://man.openbsd.org/ssh.1>ssh</a> and <a href=https://man.openbsd.org/scp.1>scp</a>, using a <a href=https://smallstep.com/blog/use-ssh-certificates/ >certificate</a>, so that you are not prompted for passwords.</p> <p>You must have <a href=https://linuxtect.com/linux-sudo-command-run-commands-with-root-privileges/ >sudo</a> rights on this server.</p> <p>If the server runs on RHEL/Centos/AlmaLinux/RockyLinux:</p> <ul> <li>the <a href=https://computingforgeeks.com/enable-powertools-repository-on-centos-rhel-linux/ >PowerTools repository</a> must be activated;</li> <li>the Git and Development Tools packages must have been installed</li> <li>the <code>mod_wsgi</code> module mentioned below is called <code>python3-mod_wsgi</code>. That means you have to modify the installation script <code>install.sh</code> before you run it, look for <code>python3-mod_wsgi</code> and uncomment that line, while commenting the line with <code>mod_wsgi</code>.</li> </ul> <p>We assume that the <a href=https://httpd.apache.org>Apache webserver</a> is already installed and:</p> <ul> <li>its config files reside in <code>/etc/httpd</code>;</li> <li>the relevant certificates are installed in <code>/etc/pki/tls/certs</code> and <code>/etc/pki/tls/private</code></li> <li><code>mod_wsgi</code> is not yet installed.</li> <li>the ports 80 and 443 are open to the outside world</li> <li><code>mod_ssl</code> is installed and activated</li> </ul> <div class="admonition caution"> <p class=admonition-title>Caution</p> <p>The installation procedure installs a bunch of Apache config file for SHEBANQ. It claims 1 process and 5 threads. You can modify this later on, manually.</p> <p><strong>But keep the number of processes to its default 1</strong> (see wsgi.conf).</p> <p>Because SHEBANQ stores global data in a cache that is local to the process. See <a href=../../server/bymodule/caching/#models.caching.CACHING>Model: CACHING</a></p> </div> <p>We assume that the following packages can be installed with <code>yum</code>. That means that you must have the right package repositories enabled.</p> <ul> <li><code>python36</code></li> <li><code>python36-devel</code></li> <li><code>python3-markdown</code></li> <li><code>mod_wsgi</code> or <code>python3-mod_wsgi</code> if on RHEL/Centos/AlmaLinux/RockyLinux</li> <li><code>mariadb</code></li> <li><code>mariadb-devel</code></li> <li><code>mariadb-server</code></li> </ul> <p>We assume that an email account is configured on the server that can be used to send emails on behalf of SHEBANQ (for password verfication and lost passwords).</p> <h3 id=local-computer>Local computer<a class=headerlink href=#local-computer title="Permanent link">&para;</a></h3> <p>You have cloned the <code>shebanq</code> and <code>bhsa</code> repositories from Github to your local computer:</p> <div class=highlight><pre><span></span><code>cd ~/github/etcbc
git clone https://github.com/etcbc/shebanq
git clone https://github.com/etcbc/bhsa
</code></pre></div> <p>If you have cloned these long ago, you can make them up to date by pulling them again:</p> <div class=highlight><pre><span></span><code>cd ~/github/etcbc/shebanq
git pull origin master
cd ~/github/etcbc/bhsa
git pull origin master
</code></pre></div> <p>You can choose to place the <code>github</code> directory somewhere else, see below, but the structure within the <code>github</code> directory must be as prescribed.</p> <h4 id=the-_local-directory>The <code>_local</code> directory<a class=headerlink href=#the-_local-directory title="Permanent link">&para;</a></h4> <p>The scripts in <code>~/github/etcbc/scripts/maintenance</code> have generic content. Before working with it, the file <code>configtemplate</code> must be edited to reflect your actual situation. Do this as follows:</p> <div class=highlight><pre><span></span><code>cd ~/github/etcbc/shebanq/scripts/maintenance
./localize.sh
</code></pre></div> <p>Now you have a directory <code>~/github/etcbc/shebanq/_local</code> And the command tells you what to do next:</p> <ul> <li>copy <code>configtemplate.sh</code> to <code>config.sh</code></li> <li>edit <code>config.sh</code></li> </ul> <p>What needs to be done is:</p> <ul> <li>adapt the <code>serverOther</code> variables to your situation:<ul> <li>provide the name of the database host server (typically: localhost)</li> <li>provide passwords for mysql users named <code>shebanq</code> and <code>shebanq_admin</code>; these users will be created and later in the installation process <code>shebanq_admin</code> is used for importing data, and after installation the webapp will use <code>shebanq</code> to fetch data in response to requests by web users.</li> <li>provide the locations where the https-certificates are installed in Apache; these will be used in in the httpd config file for the webapp.</li> <li>adapt the <code>mailServerOther</code> and <code>mailSenderOther</code> to the values that correspond to the email account you have configured for SHEBANQ emails to users.</li> </ul> </li> </ul> <p>The <code>_local</code> directory is never pushed online (because of the <code>.gitignore</code> file in the shebanq repo), so your local setup remains private. Also, when you tweak files in your <code>_local</code> directory, you can still pull new versions of the shebanq repository without overwriting your local changes.</p> <p>When you run a maintenance script, you should run them from this <code>_local</code> directory, to be sure that you run your adapted version. These local files are also the ones that are sent to the server in the provisioning step below.</p> <div class="admonition hint"> <p class=admonition-title>view and edit install.sh</p> <p>Since installation involves running <code>install.sh</code> with root privileges, you are morally obliged to open <code>_local/install.sh</code> and view its contents. If you see something you do not understand, do not run it, or run it in a sandboxed (test)-machine.</p> <p>If you are on RHEL/Centos/AlmaLinux/RockyLinux, you can now make an edit in <code>_local/install.sh</code> and uncomment the line with <code>python3-mod_wsgi</code> in it and comment the line with <code>mod_wsgi</code> in it.</p> </div> <p>The scripts can be run from any directory, because they do not depend on the current working directory.</p> <h2 id=the-scripts>The scripts<a class=headerlink href=#the-scripts title="Permanent link">&para;</a></h2> <p>The originals of the maintenance scripts are in the shebanq repository in the <code>scripts/maintenance</code> directory. In the previous step you have copied them to the <code>_local</code> directory.</p> <p>You can run all scripts with <code>--help</code> to view the options and arguments it accepts.</p> <ul> <li> <p><code>backup.sh</code></p> <ul> <li>Run it on the server.</li> <li>No need for root privileges.</li> <li>Backs up the databases that have dynamic web data:<ul> <li><code>shebanq_web</code></li> <li><code>shebanq_note</code></li> </ul> </li> <li>The backups are created in your home directory under <code>shebanq-backups</code>.</li> </ul> </li> <li> <p><code>save.sh</code></p> <ul> <li>Run it on your local computer. It will retrieve data from the server.</li> <li>Saves backups of dynamic web data from the shebanq server to a directory on your local computer where you hold backups. The backup is saved in a subfolder <code>yyyy-mm-ddT-hh-mm-ss</code> (the datetime of the backup).</li> </ul> </li> <li> <p><code>provision.sh</code></p> <ul> <li>Run it on your local computer. It will send data to the server.</li> <li>Copies all files needed for installation from your local computer to the shebanq server. These files end up in <code>shebanq-install</code> under your home directory there.</li> <li>The maintenance scripts themselves will be copied over from your <code>_local</code> directory to your home directory on the server.</li> <li>The latest backup of dynamic data from will be taken from your local computer and copied over to the server.</li> <li>You can run this script in single steps by passing an option.</li> </ul> </li> <li> <p><code>install.sh</code></p> <ul> <li>Run it on the server.</li> <li>Run it with root privileges, e.g. <code>sudo ./install.sh</code></li> <li> <p>Installs required software (MySQL, Python, ModWsgi, Emdros, Web2py, and Shebanq itself) and loads data into the databases.</p> <p>A user group <code>shebanq</code> will be created if it does not exist; the user who is you and the <code>apache</code> users are added to the members of this group. * You can run this script in single steps by passing an option.</p> </li> </ul> </li> <li> <p><code>uninstall.sh</code></p> <ul> <li>Run it on the server.</li> <li>Run it with root privileges, e.g. <code>sudo ./install.sh</code></li> <li>Uninstalls what <code>install.sh</code> has installed.</li> <li>You can run this script in single steps by passing an option.</li> </ul> </li> <li> <p><code>restore.sh</code></p> <ul> <li>Run it on the server.</li> <li>No need for root privileges.</li> <li>Restores the databases that have dynamic web data:<ul> <li><code>shebanq_web</code></li> <li><code>shebanq_note</code></li> </ul> </li> <li>They are restored from a previous backup.</li> </ul> </li> <li> <p><code>update.sh</code></p> <ul> <li>Run it on the server.</li> <li> <p>No need for root privileges, but you must be able to run a specific command with sudo without being prompted for a password:</p> <p><code>sudo -n /usr/bin/systemctl restart httpd.service</code></p> <p>and likewise for <code>start</code> and <code>stop</code>. * Updates the shebanq webapp, i.e. the web-app as it is hung into the <code>web2py</code> framework.</p> </li> </ul> </li> <li> <p><code>test.sh</code></p> <ul> <li>Run it on the server.</li> <li>No need for root privileges.</li> <li>Performs a loose bunch of tasks, such as<ul> <li>Run a controller outside Apache</li> <li>Visit the website</li> <li>Compile the application code.</li> </ul> </li> </ul> </li> </ul> <h2 id=the-situations>The situations<a class=headerlink href=#the-situations title="Permanent link">&para;</a></h2> <p>There are several situations, depending on the server that hosts SHEBANQ:</p> <ul> <li><strong>Production</strong> <code>p</code><ul> <li>url: <code>shebanq.ancient-data.org</code></li> <li>hosted by DANS on a KNAW server</li> <li>publicly accessible,</li> <li>the one and only offical shebanq website</li> </ul> </li> <li><strong>Production (new)</strong> <code>pn</code><ul> <li>url: <code>server.dans.knaw.nl</code></li> <li>hosted by DANS on a KNAW server, as a successor of the current production server</li> <li>not yet publicly accessible,</li> <li>not yet the one and only offical shebanq website</li> </ul> </li> <li><strong>Test</strong> <code>t</code><ul> <li>url: <code>test.shebanq.ancient-data.org</code></li> <li>hosted by DANS on a KNAW server</li> <li>only accessible from within the DANS-KNAW network</li> <li>the one and only offical shebanq <em>test</em> website</li> </ul> </li> <li><strong>Other</strong> <code>o</code><ul> <li>url: to be configured by you</li> <li>hosted on your server</li> <li>access managed by you</li> <li>an unoffical shebanq website (very welcome, thanks for taking the trouble)</li> </ul> </li> <li><strong>Other (new)</strong> <code>on</code><ul> <li>url: to be configured by you</li> <li>hosted on your new server, as a successor to your current server</li> <li>access managed by you</li> <li>an unoffical shebanq website</li> </ul> </li> </ul> <h2 id=the-scenarios>The scenarios<a class=headerlink href=#the-scenarios title="Permanent link">&para;</a></h2> <p>The maintenance scripts can be used in several identified scenarios, which we spell out below.</p> <p>In all situations, when on the server, you must <code>sudo</code> the invocations of the scripts or run them as root.</p> <p>It might be the case, especially on production servers, that you do not have general sudo rights and that the script as a whole can not be run with root privileges. In that case you need to have rights for specific commands to run them under sudo. That is why in some scripts the word <code>sudo</code> still appears. If it does not work for your situation, you can tweak your local copy of the script.</p> <h3 id=install-shebanq-on-a-new-server>Install SHEBANQ on a new server<a class=headerlink href=#install-shebanq-on-a-new-server title="Permanent link">&para;</a></h3> <h4 id=situation-other-first-time>Situation <strong>Other</strong> (first time)<a class=headerlink href=#situation-other-first-time title="Permanent link">&para;</a></h4> <p>This is likely your case: you want to install SHEBANQ on a server of your choice. For the sake of simplicity we assume that the database resides on the server itself and we will transport and import all data needed.</p> <p>We assume that this there is no previous dynamic data to be imported.</p> <ol> <li> <p>(local computer) <code>./provision.sh o</code></p> <p>upload all needed installation files to the server; there will also be (big) data transfers of the static databases.</p> </li> <li> <p>(server) <code>./install.sh</code></p> <p>perform the complete installation of shebanq</p> </li> <li> <p>Arrange with your internet provider to let the domain name point to the IP address of the server</p> </li> </ol> <h4 id=other-migrating><strong>Other</strong> (migrating)<a class=headerlink href=#other-migrating title="Permanent link">&para;</a></h4> <p>You have a server with SHEBANQ running and want to migrate to a new server.</p> <ol> <li> <p>(current server) <code>./backup.sh</code></p> <p>make a backup of user data</p> </li> <li> <p>(local computer) <code>./save.sh o</code></p> <p>save backup to local computer</p> </li> <li> <p>(local computer) <code>./provision.sh on</code></p> <p>upload all needed installation files to the server; the backup of the current server will be imported; there will also be (big) data transfers of the static databases.</p> </li> <li> <p>(new server) <code>./install.sh</code></p> <p>perform the complete installation of shebanq</p> </li> <li> <p>Arrange with your internet provider to let the domain name point to the IP address of the new server</p> </li> <li> <p>(local computer) Tweak <code>config.sh</code> and put the name of the new server into <code>serverOther</code>.</p> </li> </ol> <h4 id=test><strong>Test</strong><a class=headerlink href=#test title="Permanent link">&para;</a></h4> <p>The database resides on the test server itself, data operations will be performed.</p> <ol> <li> <p>(production server) <code>./backup.sh</code></p> <p>make a backup of user data (only to get meaningful content in the databases)</p> </li> <li> <p>(local computer) <code>./save.sh p</code></p> <p>save backup to local computer (only to get meaningful content in the databases)</p> </li> <li> <p>(local computer) <code>./provision.sh t</code></p> <p>upload all needed installation files to the server; there will also be (big) data transfers of the static databases.</p> </li> <li> <p>(test server) <code>./install.sh</code></p> <p>perform the complete installation of shebanq</p> </li> </ol> <h4 id=production-migrating><strong>Production</strong> (migrating)<a class=headerlink href=#production-migrating title="Permanent link">&para;</a></h4> <p>The database resides on a separate database server, no data operations needed.</p> <ol> <li> <p>(current production server) <code>./backup.sh</code></p> <p>make a backup of user data (only for safety, if all goes well, we do not need it)</p> </li> <li> <p>(local computer) <code>./save.sh p</code></p> <p>save backup from current production server to local computer (only for safety, if all goes well, we do not need it)</p> </li> <li> <p>(local computer) <code>./provision.sh pn</code></p> <p>upload all needed installation files to the new production server; the static database files will be skipped.</p> <div class="admonition hint"> <p class=admonition-title>url configuration</p> <p>The shebanq configuration file that is hung into apache will specify a virtual host with the server name as url, not <code>shebanq.ancient-data.org</code>. In this way, the new server can be tested before changing the DNS.</p> </div> </li> <li> <p>(new production server) <code>./install.sh</code></p> <p>perform the complete installation of shebanq</p> </li> <li> <p>(local computer) Tweak <code>config.sh</code></p> <p>If all went well, and shebanq works on the new machine, change your <code>_local/config.sh</code> and put the server name of the new machine in the <code>serverProd</code> variable (it was in the <code>serverProdNew</code> variable).</p> </li> <li> <p>(local computer) <code>./provision.sh p --scripts</code></p> <p>upload the scripts again. Note that we use <code>p</code> now, and not <code>pn</code>. This has the effect that the url of the virtual host in the Apache config file of shebanq will be set to <code>shebanq.ancient-data.nl</code>.</p> </li> <li> <p>(new production server) <code>./install.sh --apache</code></p> <p>This puts the updated config file in place.</p> </li> <li> <p>Arrange with your internet provider to let the domain name point to the IP address of the new production server</p> </li> </ol> <h3 id=update-shebanq-on-an-existing-server>Update SHEBANQ on an existing server<a class=headerlink href=#update-shebanq-on-an-existing-server title="Permanent link">&para;</a></h3> <p>This works the same in all situations. We give the steps for the <strong>other</strong> situation, which is most likely your situation.</p> <p>In all situations, when on the server, you must <code>sudo</code> the invocations of the scripts or run them as root.</p> <h4 id=shebanq-code-only>SHEBANQ code only<a class=headerlink href=#shebanq-code-only title="Permanent link">&para;</a></h4> <p>Do this when you noticed that the SHEBANQ repo has updates.</p> <ol> <li> <p>(server) <code>update.sh</code></p> <p>Pull the SHEBANQ repository from GitHUb</p> </li> </ol> <p>That's all. Simple and quick.</p> <h4 id=a-version-of-the-static-data>A version of the static data<a class=headerlink href=#a-version-of-the-static-data title="Permanent link">&para;</a></h4> <p>Do this when a new version of the etcbc data is released or an existing version has got an update.</p> <p>These databases are released through the <a href=https://github.com/etcbc/bhsa>etcbc/bhsa</a> repository on GitHub, in the directory <a href=https://github.com/etcbc/bhsa/tree/master/shebanq>shebanq</a>. You have them in your local clone of the BHSA.</p> <p>Below, <em>version</em> is the desired data version that you want to import, such as <code>4</code>, <code>4b</code>, <code>c</code>, <code>2017</code>, <code>2021</code>.</p> <ol> <li> <p>(local computer) <code>git pull origin master</code></p> <p>Do this in your clone of the BHSA repository. And then again in your clone of the SHEBANQ repository</p> </li> <li> <p>(local computer) <code>./provision.sh o --static</code> <em>version</em></p> <p>upload all needed data files files to the server;</p> </li> <li> <p>(server) <code>install.sh --static</code> <em>version</em></p> <p>This imports both the <code>shebanq_passage</code> and <code>shebanq_etcbc</code> databases of that version.</p> </li> <li> <p>(local computer) bulk import additional notes for the new data version</p> <p>There are currently two sets of notes that will be generated alongside an ETCBC data version: <strong>crossref</strong> and <strong>valence</strong>.</p> <p>Import them via the instructions mentioned <a href=#bulk-uploading-sets-of-notes>below</a>.</p> </li> </ol> <h4 id=emdros>Emdros<a class=headerlink href=#emdros title="Permanent link">&para;</a></h4> <p>Do this when you noticed that there is a new version of Emdros. In that case, the SHEBANQ repository contains all that is necessary.</p> <ol> <li> <p>(local computer) <code>git pull origin master</code></p> <p>Do this in your clone of the SHEBANQ repository.</p> </li> <li> <p>(local computer) Tweak <code>config.sh</code></p> <p>Adapt the <code>EMDROS_VERSION</code> variable so that it reflects the Emdros version in question.</p> </li> <li> <p>(local computer) <code>./provision.sh o --emdros</code></p> <p>Only transfer the new Emdros distribution.</p> </li> <li> <p>(server) <code>./install.sh --emdros</code></p> <p>Install Emdros only.</p> </li> <li> <p>(server) <code>update.sh</code></p> <p>Pull the SHEBANQ repository from GitHUb</p> </li> </ol> <h4 id=web2py>Web2py<a class=headerlink href=#web2py title="Permanent link">&para;</a></h4> <p>Do this when you noticed that there is a new version of Web2py and if you are sure that it does not break SHEBANQ. In that case, the SHEBANQ repository contains all that is necessary.</p> <ol> <li> <p>(local computer) <code>git pull origin master</code></p> <p>Do this in your clone of the SHEBANQ repository.</p> </li> <li> <p>(local computer) <code>./provision.sh o --web2py</code></p> <p>Only transfer the new Web2py distribution.</p> </li> <li> <p>(server) <code>./install.sh --web2py</code></p> <p>Install Web2py only.</p> </li> <li> <p>(server) <code>update.sh</code></p> <p>Pull the SHEBANQ repository from GitHUb</p> </li> </ol> <h3 id=maintain-backups-of-dynamic-data>Maintain backups of dynamic data<a class=headerlink href=#maintain-backups-of-dynamic-data title="Permanent link">&para;</a></h3> <p>The dynamic data of SHEBANQ is stored in two databases:</p> <ul> <li><code>shebanq_web</code>:<ul> <li>user data: names and email addresses and password hashes of registered users.</li> <li>query data: meta data and results of queries that have been saved in shebanq</li> </ul> </li> <li><code>shebanq_note</code>:<ul> <li>note data: metadata and content of all notes that have been saved in SHEBANQ.</li> </ul> </li> </ul> <p>Currently, I make occasional backups of the production SHEBANQ and store them on my local computer, which is backed up in multiple ways, offline and online.</p> <h4 id=backup-dynamic-data>Backup dynamic data<a class=headerlink href=#backup-dynamic-data title="Permanent link">&para;</a></h4> <ol> <li>(server) <code>./backup.sh</code></li> </ol> <p>This will create a fresh backup of the dynamic data and store it on the server in a folder with a time-stamped name. Also, a symbolic link under the name <code>latest</code> will link to that backup.</p> <ol> <li>(local computer) <code>./save.sh o</code></li> </ol> <p>This will fetch the latest backup from the server to your local computer. It will end up in your backup directory there, under the same time-stamped name, and also with a <code>latest</code> link.</p> <h4 id=restore-dynamic-data>Restore dynamic data<a class=headerlink href=#restore-dynamic-data title="Permanent link">&para;</a></h4> <p>In cases where a server has crashed and data has been lost, it is necessary to restore the latest known dynamic data.</p> <ol> <li>(local computer) <code>./provision.sh o --dynamic</code></li> </ol> <p>This will find the latest dynamic data backup of the server that exists on your local computer and upload it to the server.</p> <ol> <li>(server) <code>./restore.sh</code></li> </ol> <p>This will find the latest dynamic data backup that exists on the server and import it to the databases.</p> <div class="admonition caution"> <p class=admonition-title>Mixing backups</p> <p>If you maintain multiple servers from your local computers, the backups of all these servers end up in the same place.</p> </div> <div class="admonition hint"> <p class=admonition-title>Production and test backups are kept separate</p> <p>In order to avoid the risk of restoring a backup made on the test server to the production server, backups made on a test server are stored in a different directory. When backups are restored, they will never be taken from this directory, not even when restoring on the test server.</p> <p>If you do need to restore a test backup on the test server, you have to manually copy it over to the right place.</p> <p>The same holds for backups that come from the <code>serverOtherNew</code> and <code>serverProdNew</code> servers. These backups have no importance except for testing the processes, so they will be stored in the alternative place.</p> </div> <h3 id=import-massive-amounts-of-notes>Import massive amounts of notes<a class=headerlink href=#import-massive-amounts-of-notes title="Permanent link">&para;</a></h3> <p>The notes facility in SHEBANQ can be used for entering personal notes, but also for importing (big) sets of generated notes, such as cross-references, or syntactic annotations.</p> <p>Here is how to enable that function to users.</p> <p>We also point to the note sets that are generated by the pipeline alongside the BHSA and that should be imported with each ETCBC data version.</p> <h4 id=bulk-uploading-sets-of-notes>Bulk uploading sets of notes<a class=headerlink href=#bulk-uploading-sets-of-notes title="Permanent link">&para;</a></h4> <p>Clone the repos <a href="{{ parallells }}">etcbc/parallels</a> and <a href=https://github.com/etcbc/valence>etcbc/valence</a>.</p> <p>Like so:</p> <div class=highlight><pre><span></span><code>cd ~/github/etcbc
git clone https://github.com/etcbc/parallels
git clone https://github.com/etcbc/valence
</code></pre></div> <p>Both have a directory <code>shebanq</code> and under that subdirectories for the data versions of the BHSA. Go to the corresponding version, and locate the csv file that you find in each of those places. These are the ones you will upload.</p> <p>You have to be known to SHEBANQ as a <em>bulk uploader</em>. To make somebody into a <em>bulk uploader</em>, see <a href=#make-somebody-a-bulk-uploader>below</a>.</p> <p>Then go to the <a href=https://shebanq.ancient-data.org/hebrew/notes>notes page of shebanq</a> in your browser, and log in.</p> <p>In the right column you see a button to upload a csv file. Use it to upload the files we mentioned above.</p> <p>The notes in those files will be imported into shebanq.</p> <p>See also the <a href=https://github.com/ETCBC/shebanq/wiki/Notes-Bulk>user manual</a>.</p> <h4 id=make-somebody-a-bulk-uploader>Make somebody a bulk uploader<a class=headerlink href=#make-somebody-a-bulk-uploader title="Permanent link">&para;</a></h4> <p>Users have to be added manually to the table <code>uploaders</code> in the <code>shebanq_web</code> database. Only then they are offered to button to upload a csv file with notes.</p> <p>Find the user id in the <code>auth_user</code> table of the same database by</p> <div class=highlight><pre><span></span><code>select * from auth_user where first_name = &#39;hey&#39; and last_name = &#39;you&#39;;
</code></pre></div> <p>Pick your id from the <code>id</code> column.</p> <p>Then</p> <div class=highlight><pre><span></span><code>insert into uploaders (uid) values (yourid);
</code></pre></div> <p>That's it.</p> <h2 id=trouble-shooting>Trouble shooting<a class=headerlink href=#trouble-shooting title="Permanent link">&para;</a></h2> <p>You can add debug statements in the Python code. We have a debug helper <a href=../../server/bymodule/helpers/#helpers.debug>M: helpers.debug</a></p> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>helpers</span> <span class=kn>import</span> <span class=n>debug</span>

<span class=n>debug</span><span class=p>(</span><span class=s2>&quot;here I am&quot;</span><span class=p>)</span>
</code></pre></div> <p>but you can also do simply:</p> <div class=highlight><pre><span></span><code>import sys

sys.stderr.write(&quot;here I am\n&quot;)
</code></pre></div> <p>If you work locally, you'll see these messages on the console.</p> <p>If SHEBANQ is served under Apache, you see these messages in the Apache log files, more precisely in</p> <div class=highlight><pre><span></span><code>/var/log/httpd/shebanq_error
</code></pre></div> <p>If somehow logging fails in this way and you are desperate to get output from the server so that you can read it, switch the <code>TO_RESONSE</code> flag on, temporarily (it is here: <a href=../../server/bymodule/helpers/#helpers.debug>M: helpers.debug</a>). Then you get the messages at the top of your page, after the page has loaded.</p> <p>However, use this only in emergencies or if there are discrepancies between the SHEBANQ on your local computer and the SHEBANQ on the server.</p> <p>The recommended practice is to <a href=../computer/ >install Web2Py and SHEBANQ on your local computer</a>, and debug it there.</p> <div class="admonition caution"> <p class=admonition-title>SHEBANQ does not react to modified code</p> <p>When you have modified code directly on the server, SHEBANQ does not sense it! Two reasons:</p> <p>Web2py uses the compiled Python code, not the Python source code. And due to security reasons, Apache cannot recompile the code on the fly. So you have to do it yourself. From your home directory on the server, run</p> <div class=highlight><pre><span></span><code>./test.sh --compile
</code></pre></div> <p>The second reason is that the whole program is in the memory of the Apache process. You have to restart Apache.</p> <div class=highlight><pre><span></span><code>service httpd restart
</code></pre></div> <p>Mind: first compile, then restart.</p> <p>When you update shebanq from Github, by running the <code>update.sh</code> script, all these things are taken care of.</p> </div> <h3 id=selinux-violations>SELINUX violations<a class=headerlink href=#selinux-violations title="Permanent link">&para;</a></h3> <p>If you get an internal error, but there are no Web2Py errors listed for the SHEBANQ app, it is probably a permissions error that has nothing to do with the application logic.</p> <p>Try to run the server in <em>permissive</em> mode:</p> <div class=highlight><pre><span></span><code>setenforce 0
</code></pre></div> <p>and make a new visit to the website. If all is well, there you have the culprit. Probably all stays well if you now put the mode back to enforcing:</p> <div class=highlight><pre><span></span><code>setenforce 1
</code></pre></div> <p>But this is not et the solution. You want to know what permission got violated. On the server you can inspect the audit log</p> <div class=highlight><pre><span></span><code>ausearch -m avc --start today
</code></pre></div> <p>This gives you the violations for today. It might give you a hint to what went wrong.</p> <p>Probably the webserver needed to write a file for which it had no permissions. Obvious cases in a web2py application are:</p> <ol> <li>compilation of Python files. This standard Python behaviour compiles a Python file before running it and saves it in a <code>__pychache__</code> directory next to the Python scripts. This write action is usually not permitted in directories with code.</li> <li>Some directories should be writable by the webserver, such as logs, uploads, databases. But when these directories are removed and then recreated, their writability might also been gone.</li> </ol> <p>To remedy this, our <code>install.sh</code> and <code>update.sh</code> take great care to precompile all possible Python files (under <code>sudo</code>) and to give the writable directories the right security context, whenever they are created (<code>httpd_sys_rw_content_t</code>).</p> <h3 id=database-permissions>Database permissions<a class=headerlink href=#database-permissions title="Permanent link">&para;</a></h3> <p>The next frequent source of errors is when the database cannot be reached. Here is a checklist:</p> <ul> <li>The database should be up and running;</li> <li>The required databases should be present in the database;</li> <li>The database must allow connections with the <code>shebanq</code> user on the server; and, during installation, also to the <code>shebanq_admin</code> user;</li> <li>The database should be set up with the right grants to its data;</li> <li>The web app should provide the right credentials;</li> <li>The web app should issue legal SQL statements.</li> </ul> <p>If one of these things goes wrong, there will be error messages in the Web2py errors for SHEBANQ.</p> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../maintenance/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Installation and maintenance" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Installation and maintenance </div> </div> </a> <a href=../../elements/ class="md-footer__link md-footer__link--next" aria-label="Next: Pages" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Pages </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.8397ff9e.min.js", "version": null}</script> <script src=../../assets/javascripts/bundle.1e84347e.min.js></script> </body> </html>