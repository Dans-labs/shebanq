<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Saving Queries on the BHSA (Hebrew Bible + ETCBC linguistics)
"><meta name=author content="Dirk Roorda"><link href=https://etcbs.github.io/shebanq/deploy/maintenance/ rel=canonical><link rel=icon href=../../favicon.ico><meta name=generator content="mkdocs-1.2.2, mkdocs-material-7.2.4"><title>Maintenance - SHEBANQ</title><link rel=stylesheet href=../../assets/stylesheets/main.f7f47774.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.3f5d1f46.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css></head> <body dir=ltr data-md-color-scheme data-md-color-primary=none data-md-color-accent=none> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#installation-and-maintenance class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=SHEBANQ class="md-header__button md-logo" aria-label=SHEBANQ data-md-component=logo> <img src=../../images/shebanq_logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> SHEBANQ </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Maintenance </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/etcbc/shebanq/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> etcbc/shebanq </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=SHEBANQ class="md-nav__button md-logo" aria-label=SHEBANQ data-md-component=logo> <img src=../../images/shebanq_logo.png alt=logo> </a> SHEBANQ </label> <div class=md-nav__source> <a href=https://github.com/etcbc/shebanq/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> etcbc/shebanq </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> About <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=About data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> About </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../intro/ class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../news/ class=md-nav__link> News </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Server <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Server data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Server </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../server/intro/ class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../server/models/ class=md-nav__link> Models </a> </li> <li class=md-nav__item> <a href=../../server/controllers/ class=md-nav__link> Controllers </a> </li> <li class=md-nav__item> <a href=../../server/modules/ class=md-nav__link> Modules </a> </li> <li class=md-nav__item> <a href=../../server/views/ class=md-nav__link> Views </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Client <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Client data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Client </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../client/intro/ class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../client/css/ class=md-nav__link> CSS </a> </li> <li class=md-nav__item> <a href=../../client/js/ class=md-nav__link> Javascript </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> Deploy <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Deploy data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Deploy </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Maintenance <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Maintenance </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#motivation class=md-nav__link> Motivation </a> </li> <li class=md-nav__item> <a href=#tools class=md-nav__link> Tools </a> </li> <li class=md-nav__item> <a href=#requirements class=md-nav__link> Requirements </a> <nav class=md-nav aria-label=Requirements> <ul class=md-nav__list> <li class=md-nav__item> <a href=#server class=md-nav__link> Server </a> </li> <li class=md-nav__item> <a href=#local-computer class=md-nav__link> Local computer </a> <nav class=md-nav aria-label="Local computer"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the-_local-directory class=md-nav__link> The _local directory </a> </li> <li class=md-nav__item> <a href=#copy-files class=md-nav__link> Copy files </a> </li> <li class=md-nav__item> <a href=#tweak-files class=md-nav__link> Tweak files </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#the-scripts class=md-nav__link> The scripts </a> </li> <li class=md-nav__item> <a href=#the-situations class=md-nav__link> The situations </a> </li> <li class=md-nav__item> <a href=#the-scenarios class=md-nav__link> The scenarios </a> <nav class=md-nav aria-label="The scenarios"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#install-shebanq-on-a-new-server class=md-nav__link> Install SHEBANQ on a new server </a> <nav class=md-nav aria-label="Install SHEBANQ on a new server"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#situation-other-first-time class=md-nav__link> Situation Other (first time) </a> </li> <li class=md-nav__item> <a href=#other-migrating class=md-nav__link> Other (migrating) </a> </li> <li class=md-nav__item> <a href=#test class=md-nav__link> Test </a> </li> <li class=md-nav__item> <a href=#production-migrating class=md-nav__link> Production (migrating) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#update-shebanq-on-an-existing-server class=md-nav__link> Update SHEBANQ on an existing server </a> <nav class=md-nav aria-label="Update SHEBANQ on an existing server"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#shebanq-code-only class=md-nav__link> SHEBANQ code only </a> </li> <li class=md-nav__item> <a href=#a-version-of-the-static-data class=md-nav__link> A version of the static data </a> </li> <li class=md-nav__item> <a href=#emdros class=md-nav__link> Emdros </a> </li> <li class=md-nav__item> <a href=#web2py class=md-nav__link> Web2py </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#maintain-backups-of-dynamic-data class=md-nav__link> Maintain backups of dynamic data </a> <nav class=md-nav aria-label="Maintain backups of dynamic data"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#backup-dynamic-data class=md-nav__link> Backup dynamic data </a> </li> <li class=md-nav__item> <a href=#restore-dynamic-data class=md-nav__link> Restore dynamic data </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#motivation class=md-nav__link> Motivation </a> </li> <li class=md-nav__item> <a href=#tools class=md-nav__link> Tools </a> </li> <li class=md-nav__item> <a href=#requirements class=md-nav__link> Requirements </a> <nav class=md-nav aria-label=Requirements> <ul class=md-nav__list> <li class=md-nav__item> <a href=#server class=md-nav__link> Server </a> </li> <li class=md-nav__item> <a href=#local-computer class=md-nav__link> Local computer </a> <nav class=md-nav aria-label="Local computer"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#the-_local-directory class=md-nav__link> The _local directory </a> </li> <li class=md-nav__item> <a href=#copy-files class=md-nav__link> Copy files </a> </li> <li class=md-nav__item> <a href=#tweak-files class=md-nav__link> Tweak files </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#the-scripts class=md-nav__link> The scripts </a> </li> <li class=md-nav__item> <a href=#the-situations class=md-nav__link> The situations </a> </li> <li class=md-nav__item> <a href=#the-scenarios class=md-nav__link> The scenarios </a> <nav class=md-nav aria-label="The scenarios"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#install-shebanq-on-a-new-server class=md-nav__link> Install SHEBANQ on a new server </a> <nav class=md-nav aria-label="Install SHEBANQ on a new server"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#situation-other-first-time class=md-nav__link> Situation Other (first time) </a> </li> <li class=md-nav__item> <a href=#other-migrating class=md-nav__link> Other (migrating) </a> </li> <li class=md-nav__item> <a href=#test class=md-nav__link> Test </a> </li> <li class=md-nav__item> <a href=#production-migrating class=md-nav__link> Production (migrating) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#update-shebanq-on-an-existing-server class=md-nav__link> Update SHEBANQ on an existing server </a> <nav class=md-nav aria-label="Update SHEBANQ on an existing server"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#shebanq-code-only class=md-nav__link> SHEBANQ code only </a> </li> <li class=md-nav__item> <a href=#a-version-of-the-static-data class=md-nav__link> A version of the static data </a> </li> <li class=md-nav__item> <a href=#emdros class=md-nav__link> Emdros </a> </li> <li class=md-nav__item> <a href=#web2py class=md-nav__link> Web2py </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#maintain-backups-of-dynamic-data class=md-nav__link> Maintain backups of dynamic data </a> <nav class=md-nav aria-label="Maintain backups of dynamic data"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#backup-dynamic-data class=md-nav__link> Backup dynamic data </a> </li> <li class=md-nav__item> <a href=#restore-dynamic-data class=md-nav__link> Restore dynamic data </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/etcbc/shebanq/edit/master/docs/deploy/maintenance.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=installation-and-maintenance>Installation and maintenance<a class=headerlink href=#installation-and-maintenance title="Permanent link">&para;</a></h1> <h2 id=motivation>Motivation<a class=headerlink href=#motivation title="Permanent link">&para;</a></h2> <p><strong>The promise of SHEBANQ to its users is that the queries and notes they have saved on SHEBANQ will be accessible by a fixed URL for the indefinite future.</strong></p> <p>Therefore it is vitally important to backup this data and store those backups in a variety of places, not only on the server that hosts SHEBANQ, however well that server is being managed.</p> <p>The following tasks must be addressed:</p> <ul> <li> <p><strong>Server migration</strong></p> <p>Servers do not have eternal life, so every now and then SHEBANQ has to migrate from one server to another.</p> </li> <li> <p><strong>'Foreign' servers</strong></p> <p>We encourage people to host their own SHEBANQ, so we must support new installations of SHEBANQ on third party servers. Those servers must be maintainable as well as the offical servers.</p> </li> <li> <p><strong>Software updates</strong></p> <p>In order to keep SHEBANQ alive over the years, software updates must be carried out, not only of SHEBANQ itself, but also of the supporting systems, such as <a href=https://emdros.org>Emdros</a>, <a href=http://web2py.com>Web2Py</a>, <a href=https://www.python.org>Python</a>, and <a href=https://mariadb.org>MariaDB</a> (a replacement of <a href=https://dev.mysql.com/downloads/mysql/ >MySQL</a> ).</p> </li> <li> <p><strong>Data updates</strong></p> <p>The <a href=http://www.etcbc.nl>ETCBC</a>, as the provider of the textual and linguistic data of the Hebrew Bible, produces data updates through its <a href=https://github.com/etcbc/bhsa>BHSA</a> repository. These data updates have to find their way to the servers that host SHEBANQ.</p> </li> </ul> <p>In the carrying out of these tasks there are some additional requirements which are vital for the long-term support of SHEBANQ.</p> <ul> <li> <p><strong>Security</strong></p> <p>Servers that host SHEBANQ should be secure. The must be hardened against attacks, and the user data must be kept safe, even if SHEBANQ only stores the bare minimum of personal data (names, email addresses, password hashes).</p> </li> <li> <p><strong>Automation</strong></p> <p>Maintaining a server requires countless nitty-gritty steps, which are easily forgotten. That is the prime reason to automate all these steps. People that are new to SHEBANQ should be able to maintain SHEBANQ in a straightforward way.</p> </li> <li> <p><strong>Documentation</strong></p> <p>The maintenance of SHEBANQ should be well documented. Together with automation it is the best help we can offer to the maintainers of SHEBANQ in the years to come.</p> </li> </ul> <h2 id=tools>Tools<a class=headerlink href=#tools title="Permanent link">&para;</a></h2> <p>This repository contains a set of shell scripts to perform installation and maintenance tasks on SHEBANQ servers. It also has most of the assets needed for installation. The remaining assets are available through the <a href=https://github.com/etcbc/bhsa>BHSA</a> repository.</p> <div class="admonition caution"> <p class=admonition-title>not meant for local installations</p> <p>Although SHEBANQ can be installed on a personal computer, it is not documented here. It is considerably easier than installing it on a server.</p> </div> <div class="admonition caution"> <p class=admonition-title>SELINUX only</p> <p>So far, the scripts only support servers that run under <a href=https://en.wikipedia.org/wiki/Security-Enhanced_Linux>SELINUX</a>. Ubuntu is not currently supported. Again, installing SHEBANQ on Ubuntu is easier than on SELINUX.</p> </div> <div class="admonition caution"> <p class=admonition-title>Requirements</p> <p>Read first to the end of this document, and take note of the <strong>requirements</strong>.</p> </div> <p><a href=https://en.wikipedia.org/wiki/Security-Enhanced_Linux>SELINUX</a> might not be the most obvious choice to host SHEBANQ on, because it is considerably more difficult to work with than Ubuntu.</p> <p>However, there are a few key advantages you enjoy after the installation:</p> <ul> <li> <p><strong>prime security</strong></p> <p>You have SHEBANQ running on a top-notch secure system.</p> </li> <li> <p><strong>head-ache-free software updates</strong></p> <p>Much of supporting software (Python, MySQL, Apache) can be updated without the risk of breaking things, because the current versions of them are supported for an extra long time. Often, new security updates are back-ported to older versions, so that you can avoid upgrading to newer but incompatible versions.</p> </li> </ul> <h2 id=requirements>Requirements<a class=headerlink href=#requirements title="Permanent link">&para;</a></h2> <h3 id=server>Server<a class=headerlink href=#server title="Permanent link">&para;</a></h3> <p>The server on which SHEBANQ is installed is a <a href=https://en.wikipedia.org/wiki/Security-Enhanced_Linux>Security Enhanced Linux Server (SELINUX)</a>. You must be able to access this server by means of <a href=https://man.openbsd.org/ssh.1>ssh</a> and <a href=https://man.openbsd.org/scp.1>scp</a>, using a <a href=https://smallstep.com/blog/use-ssh-certificates/ >certificate</a>, so that you are not prompted for passwords.</p> <p>You must have <a href=https://linuxtect.com/linux-sudo-command-run-commands-with-root-privileges/ >sudo</a> rights on this server.</p> <p>We assume that the <a href=https://httpd.apache.org>Apache webserver</a> is already installed and:</p> <ul> <li>its config files reside in <code>/etc/httpd</code>;</li> <li>the relevant certificates are installed in <code>/etc/pki/tls/certs</code> and <code>/etc/pki/tls/private</code></li> <li><code>mod_wsgi</code> is not yet installed.</li> </ul> <h3 id=local-computer>Local computer<a class=headerlink href=#local-computer title="Permanent link">&para;</a></h3> <p>You have cloned the <code>shebanq</code> and <code>bhsa</code> repositories from Github to your local computer:</p> <div class=highlight><pre><span></span><code>cd ~/github/etcbc
git clone https://github.com/etcbc/shebanq
git clone https://github.com/etcbc/bhsa
</code></pre></div> <p>If you have cloned these long ago, you can make them up to date by pulling them again:</p> <div class=highlight><pre><span></span><code>cd ~/github/etcbc/shebanq
git pull origin master
cd ~/github/etcbc/bhsa
git pull origin master
</code></pre></div> <p>You can choose to place the <code>github</code> directory somewhere else, see below, but the structure within the <code>github</code> directory must be as prescribed.</p> <h4 id=the-_local-directory>The <code>_local</code> directory<a class=headerlink href=#the-_local-directory title="Permanent link">&para;</a></h4> <p>You need to create a directory <code>_local</code> in <code>~/github/etcbc/shebanq</code> with some subdirectories, copied from the shebanq repo.</p> <p>You can then make local adjustment to the configuration files.</p> <p>The <code>_local</code> directory is never pushed online (because of the <code>.gitignore</code> file in the shebanq repo), so your local setup remains private. Also, when you tweak files in your <code>_local</code> directory, you can still pull new versions of the shebanq repository without overwriting your local changes.</p> <h4 id=copy-files>Copy files<a class=headerlink href=#copy-files title="Permanent link">&para;</a></h4> <p>Start with copying the maintenance scripts to the <code>_local</code> directory:</p> <div class=highlight><pre><span></span><code>cd ~/github/etcbc/shebanq
cp -R scripts/maintenance _local/maintenance
</code></pre></div> <p>When you run a maintenance script, you should run them from your <code>_local/maintenance</code> directory, to be sure that you run your adapted version. Currently, you only have to adapt the <code>config.sh</code> script, the others will not get modified. But it is very possible that your own situation is different in ways that I have not foreseen. In that case you can freely modify your local copies as you wish.</p> <p>These local copies are also the ones that are sent to the server in the provisioning step below.</p> <p>The scripts can be run from any directory, because they do not depend on the current working directory.</p> <p>If you are going to work with your own shebanq server, do</p> <div class=highlight><pre><span></span><code>cd ~/github/etcbc/shebanq
cp -R scripts/cfg_other _local/cfg_other
cp -R scripts/apache_other _local/apache_other
</code></pre></div> <p>If you are going to work with the offical production and test servers of SHEBANQ, do</p> <div class=highlight><pre><span></span><code>cd ~/github/etcbc/shebanq
cp -R scripts/cfg_other _local/cfg_prod
cp -R scripts/apache_other _local/apache_prod
cp -R scripts/cfg_other _local/cfg_test
cp -R scripts/apache_other _local/apache_test
</code></pre></div> <h4 id=tweak-files>Tweak files<a class=headerlink href=#tweak-files title="Permanent link">&para;</a></h4> <p>You need to tweak the contents of your <code>_local</code> files to reflect your current situation.</p> <p>All maintenance scripts start with the same configuration by including <code>config.sh</code>.</p> <p>Tweak <code>config.sh</code>: adapt the <code>server</code><em>Xxx</em> variables to your situation.</p> <p>Tweak the files in <code>/apache_</code><em>xxx</em>: Adapt the url of your server, certificate locations, and other things you might wish.</p> <p>Tweak the files in <code>/cfg_</code><em>xxx</em>: Adapt credentials for the database connections.</p> <div class="admonition caution"> <p class=admonition-title>multiple files</p> <p>The connection details occur in multiple files. Have a thorough look at them all.</p> </div> <h2 id=the-scripts>The scripts<a class=headerlink href=#the-scripts title="Permanent link">&para;</a></h2> <p>The originals of the maintenance scripts are in the shebanq repository in the <code>scripts/maintenance</code> directory. In the previous step you have copied them to the <code>_local</code> directory.</p> <ul> <li> <p><code>backup.sh</code></p> <ul> <li>Run it on the server.</li> <li>Backup the databases that have dynamic web data:<ul> <li><code>shebanq_web</code></li> <li><code>shebanq_note</code></li> </ul> </li> </ul> </li> <li> <p><code>save.sh</code></p> <ul> <li>Run it on your local computer. It will retrieve data from the server.</li> <li>Save backups of dynamic web data from the shebanq server to a directory on your local computer where you hold backups. The backup is saved in a subfolder <code>yyyy-mm-ddT-hh-mm-ss</code> (the datetime of the backup).</li> </ul> </li> <li> <p><code>provision.sh</code></p> <ul> <li>Run it on your local computer. It will send data to the server.</li> <li>Copy all files needed for installation from your local computer to the shebanq server. These files end up in <code>shebanq-install</code> under your home directory there.</li> <li>The maintenance scripts themselves will be copied over from your <code>_local</code> directory to your home directory on the server.</li> <li>The latest backup of dynamic data from will be taken from your local computer and copied over to the server.</li> </ul> </li> <li> <p><code>install.sh</code></p> <ul> <li>Run it on the server. Install and configure required software. MySQL, Python, Emdros, Web2py, shebanq itself.</li> <li>Install <code>mod_wsgi</code> and configure the apache webserver.</li> <li>Fill the databases with data, if needed.</li> </ul> </li> <li> <p><code>restore.sh</code></p> <ul> <li>Run it on the server.</li> <li>Restore the databases that have dynamic web data:<ul> <li><code>shebanq_web</code></li> <li><code>shebanq_note</code></li> </ul> </li> <li>They are restored from a previous backup.</li> </ul> </li> <li> <p><code>update.sh</code></p> <ul> <li>Run it on the server.</li> <li>Update the shebanq software, i.e. the web-app as it is hung into the <code>web2py</code> framework.</li> </ul> </li> </ul> <h2 id=the-situations>The situations<a class=headerlink href=#the-situations title="Permanent link">&para;</a></h2> <p>There are several situations, depending on the server that hosts SHEBANQ:</p> <ul> <li><strong>Production</strong> <code>p</code><ul> <li>url: <code>shebanq.ancient-data.org</code></li> <li>hosted by DANS on a KNAW server</li> <li>publicly accessible,</li> <li>the one and only offical shebanq website</li> </ul> </li> <li><strong>Production (new)</strong> <code>pn</code><ul> <li>url: not yet <code>shebanq.ancient-data.org</code></li> <li>hosted by DANS on a KNAW server, as a successor of the current production server</li> <li>not yet publicly accessible,</li> <li>not yet the one and only offical shebanq website</li> </ul> </li> <li><strong>Test</strong> <code>t</code><ul> <li>url: <code>test.shebanq.ancient-data.org</code></li> <li>hosted by DANS on a KNAW server</li> <li>only accessible from within the DANS-KNAW network</li> <li>the one and only offical shebanq <em>test</em> website</li> </ul> </li> <li><strong>Other</strong> <code>o</code><ul> <li>url: to be configured by you</li> <li>hosted on your server</li> <li>access managed by you</li> <li>an unoffical shebanq website (very welcome, thanks for taking the trouble)</li> </ul> </li> <li><strong>Other (new)</strong> <code>on</code><ul> <li>url: to be configured by you</li> <li>hosted on your new server, as a successor to your current server</li> <li>access managed by you</li> <li>an unoffical shebanq website</li> </ul> </li> </ul> <h2 id=the-scenarios>The scenarios<a class=headerlink href=#the-scenarios title="Permanent link">&para;</a></h2> <p>The maintenance scripts can be used in several identified scenarios, which we spell out below.</p> <p>In all situations, when on the server, you must <code>sudo</code> the invocations of the scripts or run them as root.</p> <p>It might be the case, especially on production servers, that you do not have general sudo rights and that the script as a whole can not be run with root privileges. In that case you need to have rights for specific commands to run them under sudo. That is why in some scripts the word <code>sudo</code> still appears. If it does not work for your situation, you can tweak your local copy of the script.</p> <h3 id=install-shebanq-on-a-new-server>Install SHEBANQ on a new server<a class=headerlink href=#install-shebanq-on-a-new-server title="Permanent link">&para;</a></h3> <h4 id=situation-other-first-time>Situation <strong>Other</strong> (first time)<a class=headerlink href=#situation-other-first-time title="Permanent link">&para;</a></h4> <p>This is likely your case: you want to install SHEBANQ on a server of your choice. For the sake of simplicity we assume that the database resides on the server itself and we will transport and import all data needed.</p> <p>We assume that this there is no previous dynamic data to be imported.</p> <ol> <li> <p>(local computer) <code>./provision.sh o</code></p> <p>upload all needed installation files to the server; there will also be (big) data transfers of the static databases.</p> </li> <li> <p>(server) <code>./install.sh</code></p> <p>perform the complete installation of shebanq</p> </li> <li> <p>Arrange with your internet provider to let the domain name point to the IP address of the server</p> </li> </ol> <h4 id=other-migrating><strong>Other</strong> (migrating)<a class=headerlink href=#other-migrating title="Permanent link">&para;</a></h4> <p>You have a server with SHEBANQ running and want to migrate to a new server.</p> <ol> <li> <p>(current server) <code>./backup.sh</code></p> <p>make a backup of user data</p> </li> <li> <p>(local computer) <code>./save.sh o</code></p> <p>save backup to local computer</p> </li> <li> <p>(local computer) <code>./provision.sh on</code></p> <p>upload all needed installation files to the server; the backup of the current server will be imported; there will also be (big) data transfers of the static databases.</p> </li> <li> <p>(new server) <code>./install.sh</code></p> <p>perform the complete installation of shebanq</p> </li> <li> <p>Arrange with your internet provider to let the domain name point to the IP address of the new server</p> </li> <li> <p>(local computer) Tweak <code>config.sh</code> and put the name of the new server into <code>serverOther</code>.</p> </li> </ol> <h4 id=test><strong>Test</strong><a class=headerlink href=#test title="Permanent link">&para;</a></h4> <p>The database resides on the test server itself, data operations will be performed.</p> <ol> <li> <p>(production server) <code>./backup.sh</code></p> <p>make a backup of user data (only to get meaningful content in the databases)</p> </li> <li> <p>(local computer) <code>./save.sh p</code></p> <p>save backup to local computer (only to get meaningful content in the databases)</p> </li> <li> <p>(local computer) <code>./provision.sh t</code></p> <p>upload all needed installation files to the server; there will also be (big) data transfers of the static databases.</p> </li> <li> <p>(test server) <code>./install.sh</code></p> <p>perform the complete installation of shebanq</p> </li> </ol> <h4 id=production-migrating><strong>Production</strong> (migrating)<a class=headerlink href=#production-migrating title="Permanent link">&para;</a></h4> <p>The database resides on a separate database server, no data operations needed.</p> <ol> <li> <p>(current production server) <code>./backup.sh</code></p> <p>make a backup of user data (only for safety, if all goes well, we do not need it)</p> </li> <li> <p>(local computer) <code>./save.sh p</code></p> <p>save backup from current production server to local computer (only for safety, if all goes well, we do not need it)</p> </li> <li> <p>(local computer) <code>./provision.sh pn</code></p> <p>upload all needed installation files to the new production server; the static database files will be skipped.</p> </li> <li> <p>(new production server) <code>./install.sh</code></p> <p>perform the complete installation of shebanq</p> </li> <li> <p>Arrange with your internet provider to let the domain name point to the IP address of the new production server</p> </li> <li> <p>(local computer) Tweak <code>config.sh</code> and put the name of the new production server into <code>serverProd</code>.</p> </li> </ol> <h3 id=update-shebanq-on-an-existing-server>Update SHEBANQ on an existing server<a class=headerlink href=#update-shebanq-on-an-existing-server title="Permanent link">&para;</a></h3> <p>This works the same in all situations. We give the steps for the <strong>other</strong> situation, which is most likely your situation.</p> <p>In all situations, when on the server, you must <code>sudo</code> the invocations of the scripts or run them as root.</p> <h4 id=shebanq-code-only>SHEBANQ code only<a class=headerlink href=#shebanq-code-only title="Permanent link">&para;</a></h4> <p>Do this when you noticed that the SHEBANQ repo has updates.</p> <ol> <li> <p>(server) <code>update.sh</code></p> <p>Pull the SHEBANQ repository from GitHUb</p> </li> </ol> <p>That's all. Simple and quick.</p> <h4 id=a-version-of-the-static-data>A version of the static data<a class=headerlink href=#a-version-of-the-static-data title="Permanent link">&para;</a></h4> <p>Do this when a new version of the etcbc data is released or an existing version has got an update.</p> <p>These databases are released through the <a href=https://github.com/etcbc/bhs>etcbc/bhsa</a> repository on GitHub, in the directory <a href=https://github.com/ETCBC/bhsa/tree/master/shebanq>shebanq</a>. You have them in your local clone of the BHSA.</p> <p>Below, <em>version</em> is the desired data version that you want to import, such as <code>4</code>, <code>4b</code>, <code>c</code>, <code>2017</code>, <code>2021</code>.</p> <ol> <li> <p>(local computer) <code>git pull origin master</code></p> <p>Do this in your clone of the BHSA repository. And then again in your clone of the SHEBANQ repository</p> </li> <li> <p>(local computer) <code>./provision.sh o --static</code> <em>version</em></p> <p>upload all needed data files files to the server;</p> </li> <li> <p>(server) <code>install.sh --static</code> <em>version</em></p> <p>This imports both the <code>shebanq_passage</code> and <code>shebanq_etcbc</code> databases of that version.</p> </li> </ol> <h4 id=emdros>Emdros<a class=headerlink href=#emdros title="Permanent link">&para;</a></h4> <p>Do this when you noticed that there is a new version of Emdros. In that case, the SHEBANQ repository contains all that is necessary.</p> <ol> <li> <p>(local computer) <code>git pull origin master</code></p> <p>Do this in your clone of the SHEBANQ repository.</p> </li> <li> <p>(local computer) Tweak <code>config.sh</code></p> <p>Adapt the <code>EMDROS_VERSION</code> variable so that it reflects the Emdros version in question.</p> </li> <li> <p>(local computer) <code>./provision.sh o --emdros</code></p> <p>Only transfer the new Emdros distribution.</p> </li> <li> <p>(server) <code>./install.sh --emdros</code></p> <p>Install Emdros only.</p> </li> <li> <p>(server) <code>update.sh</code></p> <p>Pull the SHEBANQ repository from GitHUb</p> </li> </ol> <h4 id=web2py>Web2py<a class=headerlink href=#web2py title="Permanent link">&para;</a></h4> <p>Do this when you noticed that there is a new version of Web2py and if you are sure that it does not break SHEBANQ. In that case, the SHEBANQ repository contains all that is necessary.</p> <ol> <li> <p>(local computer) <code>git pull origin master</code></p> <p>Do this in your clone of the SHEBANQ repository.</p> </li> <li> <p>(local computer) <code>./provision.sh o --web2py</code></p> <p>Only transfer the new Web2py distribution.</p> </li> <li> <p>(server) <code>./install.sh --web2py</code></p> <p>Install Web2py only.</p> </li> <li> <p>(server) <code>update.sh</code></p> <p>Pull the SHEBANQ repository from GitHUb</p> </li> </ol> <h3 id=maintain-backups-of-dynamic-data>Maintain backups of dynamic data<a class=headerlink href=#maintain-backups-of-dynamic-data title="Permanent link">&para;</a></h3> <p>The dynamic data of SHEBANQ is stored in two databases:</p> <ul> <li><code>shebanq_web</code>:<ul> <li>user data: names and email addresses and password hashes of registered users.</li> <li>query data: meta data and results of queries that have been saved in shebanq</li> </ul> </li> <li><code>shebanq_note</code>:<ul> <li>note data: metadata and content of all notes that have been saved in SHEBANQ.</li> </ul> </li> </ul> <p>Currently, I make occasional backups of the production SHEBANQ and store them on my local computer, which is backed up in multiple ways, offline and online.</p> <h4 id=backup-dynamic-data>Backup dynamic data<a class=headerlink href=#backup-dynamic-data title="Permanent link">&para;</a></h4> <ol> <li>(server) <code>./backup.sh</code></li> </ol> <p>This will create a fresh backup of the dynamic data and store it on the server in a folder with a time-stamped name. Also, a symbolic link under the name <code>latest</code> will link to that backup.</p> <ol> <li>(local computer) <code>./save.sh o</code></li> </ol> <p>This will fetch the latest backup from the server to your local computer. It will end up in your backup directory there, under the same time-stamped name, and also with a <code>latest</code> link.</p> <h4 id=restore-dynamic-data>Restore dynamic data<a class=headerlink href=#restore-dynamic-data title="Permanent link">&para;</a></h4> <p>In cases where a server has crashed and data has been lost, it is necessary to restore the latest known dynamic data.</p> <ol> <li>(local computer) <code>./provision.sh o --dynamic</code></li> </ol> <p>This will find the latest dynamic data backup of the server that exists on your local computer and upload it to the server.</p> <ol> <li>(server) <code>./restore.sh</code></li> </ol> <p>This will find the latest dynamic data backup that exists on the server and import it to the databases.</p> <div class="admonition caution"> <p class=admonition-title>Mixing backups</p> <p>If you maintain multiple servers from your local computers, the backups of all these servers end up in the same place.</p> </div> <div class="admonition hint"> <p class=admonition-title>Production and test backups are kept separate</p> <p>In order to avoid the risk of restoring a backup made on the test server to the production server, backups made on a test server are stored in a different directory. When backups are restored, they will never be taken from this directory, not even when restoring on the test server.</p> <p>If you do need to restore a test backup on the test server, you have to manually copy it over to the right place.</p> <p>The same holds for backups that come from the <code>serverOtherNew</code> and <code>serverProdNew</code> servers. These backups have no importance except for testing the processes, so they will be stored in the alternative place.</p> </div> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../client/js/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Javascript" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Javascript </div> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script> <script src=../../assets/javascripts/bundle.febc23d1.min.js></script> </body> </html>