<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Saving Queries on the BHSA (Hebrew Bible + ETCBC linguistics)
"><meta name=author content="Dirk Roorda"><link href=https://etcbs.github.io/shebanq/server/modules/ rel=canonical><link rel=icon href=../../favicon.ico><meta name=generator content="mkdocs-1.2.2, mkdocs-material-7.2.4"><title>Modules - SHEBANQ</title><link rel=stylesheet href=../../assets/stylesheets/main.f7f47774.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.3f5d1f46.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/_mkdocstrings.css></head> <body dir=ltr data-md-color-scheme data-md-color-primary=none data-md-color-accent=none> <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#modules class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=SHEBANQ class="md-header__button md-logo" aria-label=SHEBANQ data-md-component=logo> <img src=../../images/shebanq_logo.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> SHEBANQ </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Modules </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/etcbc/shebanq/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> etcbc/shebanq </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=SHEBANQ class="md-nav__button md-logo" aria-label=SHEBANQ data-md-component=logo> <img src=../../images/shebanq_logo.png alt=logo> </a> SHEBANQ </label> <div class=md-nav__source> <a href=https://github.com/etcbc/shebanq/ title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> etcbc/shebanq </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_1 type=checkbox id=__nav_1> <label class=md-nav__link for=__nav_1> About <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=About data-md-level=1> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> About </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../news/ class=md-nav__link> News </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Topics <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Topics data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Topics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../topics/elements/ class=md-nav__link> Elements </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Server <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Server data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Server </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../models/ class=md-nav__link> Models </a> </li> <li class=md-nav__item> <a href=../controllers/ class=md-nav__link> Controllers </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Modules <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Modules </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#blang class=md-nav__link> blang </a> <nav class=md-nav aria-label=blang> <ul class=md-nav__list> <li class=md-nav__item> <a href=#blang.BOOK_LANGS class=md-nav__link> BOOK_LANGS </a> </li> <li class=md-nav__item> <a href=#blang.BOOK_NAMES class=md-nav__link> BOOK_NAMES </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#boiler class=md-nav__link> boiler </a> <nav class=md-nav aria-label=boiler> <ul class=md-nav__list> <li class=md-nav__item> <a href=#boiler.FIELDNAMES class=md-nav__link> FIELDNAMES </a> </li> <li class=md-nav__item> <a href=#boiler.LEGEND class=md-nav__link> LEGEND </a> </li> <li class=md-nav__item> <a href=#boiler.TEXT_TPL class=md-nav__link> TEXT_TPL </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#books class=md-nav__link> books </a> </li> <li class=md-nav__item> <a href=#chart class=md-nav__link> chart </a> <nav class=md-nav aria-label=chart> <ul class=md-nav__list> <li class=md-nav__item> <a href=#chart.CHART class=md-nav__link> CHART </a> <nav class=md-nav aria-label=CHART> <ul class=md-nav__list> <li class=md-nav__item> <a href=#chart.CHART.compose class=md-nav__link> compose() </a> <nav class=md-nav aria-label=compose()> <ul class=md-nav__list> <li class=md-nav__item> <a href=#chart.CHART.compose--returns class=md-nav__link> Returns </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#chart.CHART.get class=md-nav__link> get() </a> </li> <li class=md-nav__item> <a href=#chart.CHART.getBlocks class=md-nav__link> getBlocks() </a> </li> <li class=md-nav__item> <a href=#chart.CHART.page class=md-nav__link> page() </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#constants class=md-nav__link> constants </a> <nav class=md-nav aria-label=constants> <ul class=md-nav__list> <li class=md-nav__item> <a href=#constants.NOTFILLFIELDS class=md-nav__link> NOTFILLFIELDS </a> </li> <li class=md-nav__item> <a href=#constants.NULLDT class=md-nav__link> NULLDT </a> </li> <li class=md-nav__item> <a href=#constants.PUBLISH_FREEZE class=md-nav__link> PUBLISH_FREEZE </a> </li> <li class=md-nav__item> <a href=#constants.TPS class=md-nav__link> TPS </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#csvdata class=md-nav__link> csvdata </a> <nav class=md-nav aria-label=csvdata> <ul class=md-nav__list> <li class=md-nav__item> <a href=#csvdata.CSVDATA class=md-nav__link> CSVDATA </a> <nav class=md-nav aria-label=CSVDATA> <ul class=md-nav__list> <li class=md-nav__item> <a href=#csvdata.CSVDATA.get class=md-nav__link> get() </a> </li> <li class=md-nav__item> <a href=#csvdata.CSVDATA.page class=md-nav__link> page() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#csvdata.csv class=md-nav__link> csv() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#dbconfig class=md-nav__link> dbconfig </a> <nav class=md-nav aria-label=dbconfig> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dbconfig.CONFIG class=md-nav__link> CONFIG </a> </li> <li class=md-nav__item> <a href=#dbconfig.EMDROS_VERSIONS class=md-nav__link> EMDROS_VERSIONS </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#helpers class=md-nav__link> helpers </a> </li> <li class=md-nav__item> <a href=#materials class=md-nav__link> materials </a> </li> <li class=md-nav__item> <a href=#mql class=md-nav__link> mql </a> </li> <li class=md-nav__item> <a href=#note class=md-nav__link> note </a> </li> <li class=md-nav__item> <a href=#notesave class=md-nav__link> notesave </a> </li> <li class=md-nav__item> <a href=#notesupload class=md-nav__link> notesupload </a> </li> <li class=md-nav__item> <a href=#notetree class=md-nav__link> notetree </a> </li> <li class=md-nav__item> <a href=#query class=md-nav__link> query </a> <nav class=md-nav aria-label=query> <ul class=md-nav__list> <li class=md-nav__item> <a href=#query.QUERY class=md-nav__link> QUERY </a> <nav class=md-nav aria-label=QUERY> <ul class=md-nav__list> <li class=md-nav__item> <a href=#query.QUERY.getInfo class=md-nav__link> getInfo() </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#querychapter class=md-nav__link> querychapter </a> <nav class=md-nav aria-label=querychapter> <ul class=md-nav__list> <li class=md-nav__item> <a href=#querychapter.QUERYCHAPTER class=md-nav__link> QUERYCHAPTER </a> <nav class=md-nav aria-label=QUERYCHAPTER> <ul class=md-nav__list> <li class=md-nav__item> <a href=#querychapter.QUERYCHAPTER.updateQCindex class=md-nav__link> updateQCindex() </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#queryrecent class=md-nav__link> queryrecent </a> </li> <li class=md-nav__item> <a href=#querysave class=md-nav__link> querysave </a> </li> <li class=md-nav__item> <a href=#querytree class=md-nav__link> querytree </a> </li> <li class=md-nav__item> <a href=#record class=md-nav__link> record </a> </li> <li class=md-nav__item> <a href=#side class=md-nav__link> side </a> </li> <li class=md-nav__item> <a href=#test class=md-nav__link> test </a> </li> <li class=md-nav__item> <a href=#urls class=md-nav__link> urls </a> </li> <li class=md-nav__item> <a href=#versecontent class=md-nav__link> versecontent </a> <nav class=md-nav aria-label=versecontent> <ul class=md-nav__list> <li class=md-nav__item> <a href=#versecontent.VerseContent class=md-nav__link> VerseContent </a> <nav class=md-nav aria-label=VerseContent> <ul class=md-nav__list> <li class=md-nav__item> <a href=#versecontent.VerseContent.__init__ class=md-nav__link> __init__() </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#verses class=md-nav__link> verses </a> </li> <li class=md-nav__item> <a href=#versescontent class=md-nav__link> versescontent </a> <nav class=md-nav aria-label=versescontent> <ul class=md-nav__list> <li class=md-nav__item> <a href=#versescontent.VersesContent class=md-nav__link> VersesContent </a> <nav class=md-nav aria-label=VersesContent> <ul class=md-nav__list> <li class=md-nav__item> <a href=#versescontent.VersesContent.__init__ class=md-nav__link> __init__() </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#viewdefs class=md-nav__link> viewdefs </a> </li> <li class=md-nav__item> <a href=#viewsettings class=md-nav__link> viewsettings </a> </li> <li class=md-nav__item> <a href=#word class=md-nav__link> word </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../views/ class=md-nav__link> Views </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> Client <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Client data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Client </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../client/ class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../client/css/ class=md-nav__link> CSS </a> </li> <li class=md-nav__item> <a href=../../client/js/ class=md-nav__link> Javascript </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Deploy <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Deploy data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Deploy </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../deploy/maintenance/ class=md-nav__link> Maintenance </a> </li> <li class=md-nav__item> <a href=../../deploy/computer/ class=md-nav__link> Computer </a> </li> <li class=md-nav__item> <a href=../../deploy/server/ class=md-nav__link> Server </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#blang class=md-nav__link> blang </a> <nav class=md-nav aria-label=blang> <ul class=md-nav__list> <li class=md-nav__item> <a href=#blang.BOOK_LANGS class=md-nav__link> BOOK_LANGS </a> </li> <li class=md-nav__item> <a href=#blang.BOOK_NAMES class=md-nav__link> BOOK_NAMES </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#boiler class=md-nav__link> boiler </a> <nav class=md-nav aria-label=boiler> <ul class=md-nav__list> <li class=md-nav__item> <a href=#boiler.FIELDNAMES class=md-nav__link> FIELDNAMES </a> </li> <li class=md-nav__item> <a href=#boiler.LEGEND class=md-nav__link> LEGEND </a> </li> <li class=md-nav__item> <a href=#boiler.TEXT_TPL class=md-nav__link> TEXT_TPL </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#books class=md-nav__link> books </a> </li> <li class=md-nav__item> <a href=#chart class=md-nav__link> chart </a> <nav class=md-nav aria-label=chart> <ul class=md-nav__list> <li class=md-nav__item> <a href=#chart.CHART class=md-nav__link> CHART </a> <nav class=md-nav aria-label=CHART> <ul class=md-nav__list> <li class=md-nav__item> <a href=#chart.CHART.compose class=md-nav__link> compose() </a> <nav class=md-nav aria-label=compose()> <ul class=md-nav__list> <li class=md-nav__item> <a href=#chart.CHART.compose--returns class=md-nav__link> Returns </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#chart.CHART.get class=md-nav__link> get() </a> </li> <li class=md-nav__item> <a href=#chart.CHART.getBlocks class=md-nav__link> getBlocks() </a> </li> <li class=md-nav__item> <a href=#chart.CHART.page class=md-nav__link> page() </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#constants class=md-nav__link> constants </a> <nav class=md-nav aria-label=constants> <ul class=md-nav__list> <li class=md-nav__item> <a href=#constants.NOTFILLFIELDS class=md-nav__link> NOTFILLFIELDS </a> </li> <li class=md-nav__item> <a href=#constants.NULLDT class=md-nav__link> NULLDT </a> </li> <li class=md-nav__item> <a href=#constants.PUBLISH_FREEZE class=md-nav__link> PUBLISH_FREEZE </a> </li> <li class=md-nav__item> <a href=#constants.TPS class=md-nav__link> TPS </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#csvdata class=md-nav__link> csvdata </a> <nav class=md-nav aria-label=csvdata> <ul class=md-nav__list> <li class=md-nav__item> <a href=#csvdata.CSVDATA class=md-nav__link> CSVDATA </a> <nav class=md-nav aria-label=CSVDATA> <ul class=md-nav__list> <li class=md-nav__item> <a href=#csvdata.CSVDATA.get class=md-nav__link> get() </a> </li> <li class=md-nav__item> <a href=#csvdata.CSVDATA.page class=md-nav__link> page() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#csvdata.csv class=md-nav__link> csv() </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#dbconfig class=md-nav__link> dbconfig </a> <nav class=md-nav aria-label=dbconfig> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dbconfig.CONFIG class=md-nav__link> CONFIG </a> </li> <li class=md-nav__item> <a href=#dbconfig.EMDROS_VERSIONS class=md-nav__link> EMDROS_VERSIONS </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#helpers class=md-nav__link> helpers </a> </li> <li class=md-nav__item> <a href=#materials class=md-nav__link> materials </a> </li> <li class=md-nav__item> <a href=#mql class=md-nav__link> mql </a> </li> <li class=md-nav__item> <a href=#note class=md-nav__link> note </a> </li> <li class=md-nav__item> <a href=#notesave class=md-nav__link> notesave </a> </li> <li class=md-nav__item> <a href=#notesupload class=md-nav__link> notesupload </a> </li> <li class=md-nav__item> <a href=#notetree class=md-nav__link> notetree </a> </li> <li class=md-nav__item> <a href=#query class=md-nav__link> query </a> <nav class=md-nav aria-label=query> <ul class=md-nav__list> <li class=md-nav__item> <a href=#query.QUERY class=md-nav__link> QUERY </a> <nav class=md-nav aria-label=QUERY> <ul class=md-nav__list> <li class=md-nav__item> <a href=#query.QUERY.getInfo class=md-nav__link> getInfo() </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#querychapter class=md-nav__link> querychapter </a> <nav class=md-nav aria-label=querychapter> <ul class=md-nav__list> <li class=md-nav__item> <a href=#querychapter.QUERYCHAPTER class=md-nav__link> QUERYCHAPTER </a> <nav class=md-nav aria-label=QUERYCHAPTER> <ul class=md-nav__list> <li class=md-nav__item> <a href=#querychapter.QUERYCHAPTER.updateQCindex class=md-nav__link> updateQCindex() </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#queryrecent class=md-nav__link> queryrecent </a> </li> <li class=md-nav__item> <a href=#querysave class=md-nav__link> querysave </a> </li> <li class=md-nav__item> <a href=#querytree class=md-nav__link> querytree </a> </li> <li class=md-nav__item> <a href=#record class=md-nav__link> record </a> </li> <li class=md-nav__item> <a href=#side class=md-nav__link> side </a> </li> <li class=md-nav__item> <a href=#test class=md-nav__link> test </a> </li> <li class=md-nav__item> <a href=#urls class=md-nav__link> urls </a> </li> <li class=md-nav__item> <a href=#versecontent class=md-nav__link> versecontent </a> <nav class=md-nav aria-label=versecontent> <ul class=md-nav__list> <li class=md-nav__item> <a href=#versecontent.VerseContent class=md-nav__link> VerseContent </a> <nav class=md-nav aria-label=VerseContent> <ul class=md-nav__list> <li class=md-nav__item> <a href=#versecontent.VerseContent.__init__ class=md-nav__link> __init__() </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#verses class=md-nav__link> verses </a> </li> <li class=md-nav__item> <a href=#versescontent class=md-nav__link> versescontent </a> <nav class=md-nav aria-label=versescontent> <ul class=md-nav__list> <li class=md-nav__item> <a href=#versescontent.VersesContent class=md-nav__link> VersesContent </a> <nav class=md-nav aria-label=VersesContent> <ul class=md-nav__list> <li class=md-nav__item> <a href=#versescontent.VersesContent.__init__ class=md-nav__link> __init__() </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#viewdefs class=md-nav__link> viewdefs </a> </li> <li class=md-nav__item> <a href=#viewsettings class=md-nav__link> viewsettings </a> </li> <li class=md-nav__item> <a href=#word class=md-nav__link> word </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/etcbc/shebanq/edit/master/docs/server/modules.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=modules>Modules<a class=headerlink href=#modules title="Permanent link">&para;</a></h1> <p>Modules perform dedicated data retrieval and composition tasks. These tasks have been delegated to them by the controllers.</p> <p>This document collects the docstrings from the modules.</p> <div class="admonition hint"> <p class=admonition-title>Use the right sidebar</p> <p>Do not read this long document sequentially. Use the navigation in the right sidebar.</p> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=blang class="doc doc-heading"> <code>blang</code> <a href=#blang class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h3 id=blang.BOOK_LANGS class="doc doc-heading"> <code class="codehilite language-python"><span class=n>BOOK_LANGS</span></code> <a href=#blang.BOOK_LANGS class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Languages for bible book names</p> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=blang.BOOK_NAMES class="doc doc-heading"> <code class="codehilite language-python"><span class=n>BOOK_NAMES</span></code> <a href=#blang.BOOK_NAMES class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Book names in all the languages</p> </div> </div> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=boiler class="doc doc-heading"> <code>boiler</code> <a href=#boiler class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h3 id=boiler.FIELDNAMES class="doc doc-heading"> <code class="codehilite language-python"><span class=n>FIELDNAMES</span></code> <a href=#boiler.FIELDNAMES class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Lists of field names of the data that is displayed in text presentations.</p> <p>Keyed by the code of the text presentation type, the values are combinations of data type (word, phrase, clause etc.) and feature name (gloss, phono, gender, etc.)</p> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=boiler.LEGEND class="doc doc-heading"> <code class="codehilite language-python"><span class=n>LEGEND</span></code> <a href=#boiler.LEGEND class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>The legend as an HTML table.</p> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=boiler.TEXT_TPL class="doc doc-heading"> <code class="codehilite language-python"><span class=n>TEXT_TPL</span></code> <a href=#boiler.TEXT_TPL class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>The representation of a word in data view as an HTML table.</p> </div> </div> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=books class="doc doc-heading"> <code>books</code> <a href=#books class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=chart class="doc doc-heading"> <code>chart</code> <a href=#chart class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h3 id=chart.CHART class="doc doc-heading"> <code> CHART </code> <a href=#chart.CHART class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Make heat maps of lists of items.</p> <p>The items are word occurrences or query results or note set members. We divide the bible in 500-word blocks and count the number of items per block.</p> <p>We present the blocks in a chart, where each block shows the number of items by means of color.</p> <p>The blocks are clickable and move to the chapter in which the first word of the block occurs.</p> <div class="doc doc-children"> <div class="doc doc-object doc-method"> <h4 id=chart.CHART.compose class="doc doc-heading"> <code class="codehilite language-python"><span class=n>compose</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vr</span><span class=p>,</span> <span class=n>slotSets</span><span class=p>)</span></code> <a href=#chart.CHART.compose class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Organize the raw chart data in books and then in blocks.</p> <h6 id=chart.CHART.compose--returns>Returns<a class=headerlink href=#chart.CHART.compose--returns title="Permanent link">&para;</a></h6> <p>dict keyed by book, with values lists of blocks where each block is a tuple (chapter number, start position, end position, number of results, size)</p> <details class=quote> <summary>Source code in <code>modules/chart.py</code></summary> <div class=codehilite><pre><span></span><code><span class=k>def</span> <span class=nf>compose</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vr</span><span class=p>,</span> <span class=n>slotSets</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;Organize the raw chart data in books and then in blocks.</span>

<span class=sd>    Returns</span>
<span class=sd>    -------</span>
<span class=sd>    dict</span>
<span class=sd>        keyed by book, with values lists of blocks</span>
<span class=sd>        where each block is a tuple</span>
<span class=sd>        (chapter number, start position, end position, number of results, size)</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>Books</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>Books</span>

    <span class=n>slots</span> <span class=o>=</span> <span class=n>flatten</span><span class=p>(</span><span class=n>slotSets</span><span class=p>)</span>
    <span class=n>chart</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=n>chartOrder</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>slots</span><span class=p>):</span>
        <span class=p>(</span><span class=n>books</span><span class=p>,</span> <span class=n>booksOrder</span><span class=p>,</span> <span class=n>bookIds</span><span class=p>,</span> <span class=n>bookName</span><span class=p>)</span> <span class=o>=</span> <span class=n>Books</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>vr</span><span class=p>)</span>
        <span class=p>(</span><span class=n>blocks</span><span class=p>,</span> <span class=n>blockMapping</span><span class=p>)</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>getBlocks</span><span class=p>(</span><span class=n>vr</span><span class=p>)</span>
        <span class=n>results</span> <span class=o>=</span> <span class=p>{}</span>

        <span class=k>for</span> <span class=n>bl</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>blocks</span><span class=p>)):</span>
            <span class=n>results</span><span class=p>[</span><span class=n>bl</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span>
        <span class=k>for</span> <span class=n>bk</span> <span class=ow>in</span> <span class=n>booksOrder</span><span class=p>:</span>
            <span class=n>chart</span><span class=p>[</span><span class=n>bk</span><span class=p>]</span> <span class=o>=</span> <span class=p>[]</span>
            <span class=n>chartOrder</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>bk</span><span class=p>)</span>
        <span class=k>for</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>slots</span><span class=p>:</span>
            <span class=n>results</span><span class=p>[</span><span class=n>blockMapping</span><span class=p>[</span><span class=n>m</span><span class=p>]]</span> <span class=o>+=</span> <span class=mi>1</span>
        <span class=k>for</span> <span class=n>bl</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>blocks</span><span class=p>)):</span>
            <span class=p>(</span><span class=n>bk</span><span class=p>,</span> <span class=n>chpStart</span><span class=p>,</span> <span class=n>chpEnd</span><span class=p>,</span> <span class=n>size</span><span class=p>)</span> <span class=o>=</span> <span class=n>blocks</span><span class=p>[</span><span class=n>bl</span><span class=p>]</span>
            <span class=n>r</span> <span class=o>=</span> <span class=n>results</span><span class=p>[</span><span class=n>bl</span><span class=p>]</span>
            <span class=n>chart</span><span class=p>[</span><span class=n>bk</span><span class=p>]</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>chpStart</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>chpStart</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>chpEnd</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>r</span><span class=p>,</span> <span class=n>size</span><span class=p>))</span>

    <span class=k>return</span> <span class=nb>dict</span><span class=p>(</span><span class=n>chart</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>chart</span><span class=p>),</span> <span class=n>chartOrder</span><span class=o>=</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>chartOrder</span><span class=p>))</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-method"> <h4 id=chart.CHART.get class="doc doc-heading"> <code class="codehilite language-python"><span class=n>get</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vr</span><span class=p>,</span> <span class=n>qw</span><span class=p>,</span> <span class=n>iidRep</span><span class=p>)</span></code> <a href=#chart.CHART.get class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Get chart data, using the cache.</p> <details class=quote> <summary>Source code in <code>modules/chart.py</code></summary> <div class=codehilite><pre><span></span><code><span class=k>def</span> <span class=nf>get</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vr</span><span class=p>,</span> <span class=n>qw</span><span class=p>,</span> <span class=n>iidRep</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;Get chart data, using the cache.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>Caching</span> <span class=o>=</span> <span class=n>current</span><span class=o>.</span><span class=n>Caching</span>

    <span class=k>return</span> <span class=n>Caching</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
        <span class=sa>f</span><span class=s2>&quot;chart_</span><span class=si>{</span><span class=n>vr</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>qw</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>iidRep</span><span class=si>}</span><span class=s2>_&quot;</span><span class=p>,</span>
        <span class=k>lambda</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_c</span><span class=p>(</span><span class=n>vr</span><span class=p>,</span> <span class=n>qw</span><span class=p>,</span> <span class=n>iidRep</span><span class=p>),</span>
        <span class=kc>None</span><span class=p>,</span>
    <span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-method"> <h4 id=chart.CHART.getBlocks class="doc doc-heading"> <code class="codehilite language-python"><span class=n>getBlocks</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vr</span><span class=p>)</span></code> <a href=#chart.CHART.getBlocks class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Get info on the 500-word blocks.</p> <ul> <li>for each slot: to which block it belongs,</li> <li>for each block: book and chapter number of first word.</li> </ul> <p>Possibly there are gaps between books.</p> <details class=quote> <summary>Source code in <code>modules/chart.py</code></summary> <div class=codehilite><pre><span></span><code><span class=k>def</span> <span class=nf>getBlocks</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vr</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;Get info on the 500-word blocks.</span>

<span class=sd>    *   for each slot: to which block it belongs,</span>
<span class=sd>    *   for each block: book and chapter number of first word.</span>

<span class=sd>    Possibly there are gaps between books.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>Caching</span> <span class=o>=</span> <span class=n>current</span><span class=o>.</span><span class=n>Caching</span>
    <span class=k>return</span> <span class=n>Caching</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;blocks_</span><span class=si>{</span><span class=n>vr</span><span class=si>}</span><span class=s2>_&quot;</span><span class=p>,</span> <span class=k>lambda</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>getBlocks_c</span><span class=p>(</span><span class=n>vr</span><span class=p>),</span> <span class=kc>None</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-method"> <h4 id=chart.CHART.page class="doc doc-heading"> <code class="codehilite language-python"><span class=n>page</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span></code> <a href=#chart.CHART.page class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Read request parameters and get chart data ready for the controller.</p> <details class=quote> <summary>Source code in <code>modules/chart.py</code></summary> <div class=codehilite><pre><span></span><code><span class=k>def</span> <span class=nf>page</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;Read request parameters and get chart data ready for the controller.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>Check</span> <span class=o>=</span> <span class=n>current</span><span class=o>.</span><span class=n>Check</span>
    <span class=n>Record</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>Record</span>

    <span class=n>vr</span> <span class=o>=</span> <span class=n>Check</span><span class=o>.</span><span class=n>field</span><span class=p>(</span><span class=s2>&quot;material&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=s2>&quot;version&quot;</span><span class=p>)</span>
    <span class=n>mr</span> <span class=o>=</span> <span class=n>Check</span><span class=o>.</span><span class=n>field</span><span class=p>(</span><span class=s2>&quot;material&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=s2>&quot;mr&quot;</span><span class=p>)</span>
    <span class=n>qw</span> <span class=o>=</span> <span class=n>Check</span><span class=o>.</span><span class=n>field</span><span class=p>(</span><span class=s2>&quot;material&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=s2>&quot;qw&quot;</span><span class=p>)</span>
    <span class=n>iidRep</span> <span class=o>=</span> <span class=n>Check</span><span class=o>.</span><span class=n>field</span><span class=p>(</span><span class=s2>&quot;material&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=s2>&quot;iid&quot;</span><span class=p>)</span>

    <span class=p>(</span><span class=n>authorized</span><span class=p>,</span> <span class=n>msg</span><span class=p>)</span> <span class=o>=</span> <span class=n>Record</span><span class=o>.</span><span class=n>authRead</span><span class=p>(</span><span class=n>mr</span><span class=p>,</span> <span class=n>qw</span><span class=p>,</span> <span class=n>iidRep</span><span class=p>)</span>
    <span class=k>if</span> <span class=ow>not</span> <span class=n>authorized</span><span class=p>:</span>
        <span class=c1># produce empty chart</span>
        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>compose</span><span class=p>(</span><span class=n>vr</span><span class=p>,</span> <span class=p>[])</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>vr</span><span class=p>,</span> <span class=n>qw</span><span class=p>,</span> <span class=n>iidRep</span><span class=p>)</span>

    <span class=n>result</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>qw</span><span class=o>=</span><span class=n>qw</span><span class=p>)</span>
    <span class=n>result</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>msg</span><span class=o>=</span><span class=n>msg</span><span class=p>)</span>
    <span class=k>return</span> <span class=n>result</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=constants class="doc doc-heading"> <code>constants</code> <a href=#constants class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h3 id=constants.NOTFILLFIELDS class="doc doc-heading"> <code class="codehilite language-python"><span class=n>NOTFILLFIELDS</span></code> <a href=#constants.NOTFILLFIELDS class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Fields that, when represented in HTML, should not be filled with a non breaking space when empty.</p> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=constants.NULLDT class="doc doc-heading"> <code class="codehilite language-python"><span class=n>NULLDT</span></code> <a href=#constants.NULLDT class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Empty date time representation.</p> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=constants.PUBLISH_FREEZE class="doc doc-heading"> <code class="codehilite language-python"><span class=n>PUBLISH_FREEZE</span></code> <a href=#constants.PUBLISH_FREEZE class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Time interval after which publishing is irrevocable.</p> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=constants.TPS class="doc doc-heading"> <code class="codehilite language-python"><span class=n>TPS</span></code> <a href=#constants.TPS class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Types of records in query tree view.</p> </div> </div> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=csvdata class="doc doc-heading"> <code>csvdata</code> <a href=#csvdata class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h3 id=csvdata.CSVDATA class="doc doc-heading"> <code> CSVDATA </code> <a href=#csvdata.CSVDATA class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>roduces various kinds of csv exports of lists of items.</p> <p>Items are word occirrences, query results or noteset members.</p> <div class="doc doc-children"> <div class="doc doc-object doc-method"> <h4 id=csvdata.CSVDATA.get class="doc doc-heading"> <code class="codehilite language-python"><span class=n>get</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vr</span><span class=p>,</span> <span class=n>mr</span><span class=p>,</span> <span class=n>qw</span><span class=p>,</span> <span class=n>iid</span><span class=p>,</span> <span class=n>keywords</span><span class=p>,</span> <span class=n>tp</span><span class=p>,</span> <span class=n>extra</span><span class=p>,</span> <span class=n>hebrewFields</span><span class=p>,</span> <span class=n>fileName</span><span class=p>)</span></code> <a href=#csvdata.CSVDATA.get class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Get csv data as specified by parameters.</p> <details class=quote> <summary>Source code in <code>modules/csvdata.py</code></summary> <div class=codehilite><pre><span></span><code><span class=k>def</span> <span class=nf>get</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vr</span><span class=p>,</span> <span class=n>mr</span><span class=p>,</span> <span class=n>qw</span><span class=p>,</span> <span class=n>iid</span><span class=p>,</span> <span class=n>keywords</span><span class=p>,</span> <span class=n>tp</span><span class=p>,</span> <span class=n>extra</span><span class=p>,</span> <span class=n>hebrewFields</span><span class=p>,</span> <span class=n>fileName</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;Get csv data as specified by parameters.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=n>Word</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>Word</span>
    <span class=n>Query</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>Query</span>
    <span class=n>auth</span> <span class=o>=</span> <span class=n>current</span><span class=o>.</span><span class=n>auth</span>
    <span class=n>PASSAGE_DBS</span> <span class=o>=</span> <span class=n>current</span><span class=o>.</span><span class=n>PASSAGE_DBS</span>

    <span class=k>if</span> <span class=n>extra</span><span class=p>:</span>
        <span class=n>extra</span> <span class=o>=</span> <span class=s2>&quot;_&quot;</span> <span class=o>+</span> <span class=n>extra</span>
    <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>extra</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>64</span><span class=p>:</span>
        <span class=n>extra</span> <span class=o>=</span> <span class=n>extra</span><span class=p>[</span><span class=mi>0</span><span class=p>:</span><span class=mi>64</span><span class=p>]</span>

    <span class=n>headRow</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&quot;book&quot;</span><span class=p>,</span> <span class=s2>&quot;chapter&quot;</span><span class=p>,</span> <span class=s2>&quot;verse&quot;</span><span class=p>]</span> <span class=o>+</span> <span class=p>[</span><span class=n>hf</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=k>for</span> <span class=n>hf</span> <span class=ow>in</span> <span class=n>hebrewFields</span><span class=p>]</span>

    <span class=k>if</span> <span class=n>qw</span> <span class=o>==</span> <span class=s2>&quot;n&quot;</span><span class=p>:</span>
        <span class=n>keywordsSql</span> <span class=o>=</span> <span class=n>keywords</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;&#39;&quot;</span><span class=p>,</span> <span class=s2>&quot;&#39;&#39;&quot;</span><span class=p>)</span>
        <span class=n>myId</span> <span class=o>=</span> <span class=n>auth</span><span class=o>.</span><span class=n>user</span><span class=o>.</span><span class=n>id</span> <span class=k>if</span> <span class=n>auth</span><span class=o>.</span><span class=n>user</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=k>else</span> <span class=kc>None</span>
        <span class=n>extra</span> <span class=o>=</span> <span class=s2>&quot;&quot;</span> <span class=k>if</span> <span class=n>myId</span> <span class=ow>is</span> <span class=kc>None</span> <span class=k>else</span> <span class=sa>f</span><span class=s2>&quot; or created_by = </span><span class=si>{</span><span class=n>myId</span><span class=si>}</span><span class=s2> &quot;</span>

        <span class=n>hflist</span> <span class=o>=</span> <span class=s2>&quot;, &quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>hf</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=k>for</span> <span class=n>hf</span> <span class=ow>in</span> <span class=n>hebrewFields</span><span class=p>)</span>
        <span class=n>sql</span> <span class=o>=</span> <span class=n>dedent</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
<span class=s2>            select</span>
<span class=s2>                shebanq_note.note.book,</span>
<span class=s2>                shebanq_note.note.chapter,</span>
<span class=s2>                shebanq_note.note.verse,</span>
<span class=s2>                </span><span class=si>{</span><span class=n>hflist</span><span class=si>}</span><span class=s2></span>
<span class=s2>            from shebanq_note.note</span>
<span class=s2>            inner join book</span>
<span class=s2>            on shebanq_note.note.book = book.name</span>
<span class=s2>            inner join clause_atom</span>
<span class=s2>            on clause_atom.ca_num = shebanq_note.note.clause_atom</span>
<span class=s2>                and clause_atom.book_id = book.id</span>
<span class=s2>            where shebanq_note.note.keywords like &#39;% </span><span class=si>{</span><span class=n>keywordsSql</span><span class=si>}</span><span class=s2> %&#39;</span>
<span class=s2>                and shebanq_note.note.version = &#39;</span><span class=si>{</span><span class=n>vr</span><span class=si>}</span><span class=s2>&#39;</span>
<span class=s2>                and (shebanq_note.note.is_shared = &#39;T&#39; </span><span class=si>{</span><span class=n>extra</span><span class=si>}</span><span class=s2>)</span>
<span class=s2>            ;</span>
<span class=s2>            &quot;&quot;&quot;</span>
        <span class=p>)</span>
        <span class=n>dataRows</span> <span class=o>=</span> <span class=n>PASSAGE_DBS</span><span class=p>[</span><span class=n>vr</span><span class=p>]</span><span class=o>.</span><span class=n>executesql</span><span class=p>(</span><span class=n>sql</span><span class=p>)</span> <span class=k>if</span> <span class=n>vr</span> <span class=ow>in</span> <span class=n>PASSAGE_DBS</span> <span class=k>else</span> <span class=p>[]</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=p>(</span><span class=n>nSlots</span><span class=p>,</span> <span class=n>slotSets</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span>
            <span class=n>Query</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=n>vr</span><span class=p>,</span> <span class=n>iid</span><span class=p>)</span> <span class=k>if</span> <span class=n>qw</span> <span class=o>==</span> <span class=s2>&quot;q&quot;</span> <span class=k>else</span> <span class=n>Word</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=n>vr</span><span class=p>,</span> <span class=n>iid</span><span class=p>)</span>
        <span class=p>)</span>
        <span class=n>slots</span> <span class=o>=</span> <span class=n>flatten</span><span class=p>(</span><span class=n>slotSets</span><span class=p>)</span>
        <span class=n>dataRows</span> <span class=o>=</span> <span class=p>[]</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>slots</span><span class=p>):</span>
            <span class=n>hflist</span> <span class=o>=</span> <span class=s2>&quot;, &quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;word.</span><span class=si>{</span><span class=n>hf</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=si>}</span><span class=s2>&quot;</span> <span class=k>for</span> <span class=n>hf</span> <span class=ow>in</span> <span class=n>hebrewFields</span><span class=p>)</span>
            <span class=n>slotsVal</span> <span class=o>=</span> <span class=s2>&quot;,&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>slots</span><span class=p>)</span>
            <span class=n>sql</span> <span class=o>=</span> <span class=n>dedent</span><span class=p>(</span>
                <span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
<span class=s2>                select</span>
<span class=s2>                    book.name, chapter.chapter_num, verse.verse_num,</span>
<span class=s2>                    </span><span class=si>{</span><span class=n>hflist</span><span class=si>}</span><span class=s2></span>
<span class=s2>                from word</span>
<span class=s2>                inner join word_verse on</span>
<span class=s2>                    word_verse.anchor = word.word_number</span>
<span class=s2>                inner join verse on</span>
<span class=s2>                    verse.id = word_verse.verse_id</span>
<span class=s2>                inner join chapter on</span>
<span class=s2>                    verse.chapter_id = chapter.id</span>
<span class=s2>                inner join book on</span>
<span class=s2>                    chapter.book_id = book.id</span>
<span class=s2>                where</span>
<span class=s2>                    word.word_number in (</span><span class=si>{</span><span class=n>slotsVal</span><span class=si>}</span><span class=s2>)</span>
<span class=s2>                order by</span>
<span class=s2>                    word.word_number</span>
<span class=s2>                ;</span>
<span class=s2>                &quot;&quot;&quot;</span>
            <span class=p>)</span>
            <span class=n>dataRows</span> <span class=o>=</span> <span class=n>PASSAGE_DBS</span><span class=p>[</span><span class=n>vr</span><span class=p>]</span><span class=o>.</span><span class=n>executesql</span><span class=p>(</span><span class=n>sql</span><span class=p>)</span> <span class=k>if</span> <span class=n>vr</span> <span class=ow>in</span> <span class=n>PASSAGE_DBS</span> <span class=k>else</span> <span class=p>[]</span>
    <span class=n>allRows</span> <span class=o>=</span> <span class=n>csv</span><span class=p>([</span><span class=n>headRow</span><span class=p>]</span> <span class=o>+</span> <span class=nb>list</span><span class=p>(</span><span class=n>dataRows</span><span class=p>))</span>
    <span class=k>return</span> <span class=n>allRows</span>
</code></pre></div> </details> </div> </div> <div class="doc doc-object doc-method"> <h4 id=csvdata.CSVDATA.page class="doc doc-heading"> <code class="codehilite language-python"><span class=n>page</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span></code> <a href=#csvdata.CSVDATA.page class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Read request parameters and get the data and ready for the controller.</p> <details class=quote> <summary>Source code in <code>modules/csvdata.py</code></summary> <div class=codehilite><pre><span></span><code><span class=k>def</span> <span class=nf>page</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;Read request parameters and get the data and ready for the controller.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>ViewDefs</span> <span class=o>=</span> <span class=n>current</span><span class=o>.</span><span class=n>ViewDefs</span>
    <span class=n>Check</span> <span class=o>=</span> <span class=n>current</span><span class=o>.</span><span class=n>Check</span>
    <span class=n>Record</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>Record</span>

    <span class=n>vr</span> <span class=o>=</span> <span class=n>Check</span><span class=o>.</span><span class=n>field</span><span class=p>(</span><span class=s2>&quot;material&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=s2>&quot;version&quot;</span><span class=p>)</span>
    <span class=n>iidRep</span> <span class=o>=</span> <span class=n>Check</span><span class=o>.</span><span class=n>field</span><span class=p>(</span><span class=s2>&quot;material&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=s2>&quot;iid&quot;</span><span class=p>)</span>
    <span class=n>mr</span> <span class=o>=</span> <span class=n>Check</span><span class=o>.</span><span class=n>field</span><span class=p>(</span><span class=s2>&quot;material&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=s2>&quot;mr&quot;</span><span class=p>)</span>
    <span class=n>qw</span> <span class=o>=</span> <span class=n>Check</span><span class=o>.</span><span class=n>field</span><span class=p>(</span><span class=s2>&quot;material&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=s2>&quot;qw&quot;</span><span class=p>)</span>
    <span class=n>tp</span> <span class=o>=</span> <span class=n>Check</span><span class=o>.</span><span class=n>field</span><span class=p>(</span><span class=s2>&quot;material&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=s2>&quot;tp&quot;</span><span class=p>)</span>
    <span class=n>extra</span> <span class=o>=</span> <span class=n>Check</span><span class=o>.</span><span class=n>field</span><span class=p>(</span><span class=s2>&quot;rest&quot;</span><span class=p>,</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=s2>&quot;extra&quot;</span><span class=p>)</span>

    <span class=p>(</span><span class=n>iid</span><span class=p>,</span> <span class=n>keywords</span><span class=p>)</span> <span class=o>=</span> <span class=n>iDecode</span><span class=p>(</span><span class=n>qw</span><span class=p>,</span> <span class=n>iidRep</span><span class=p>)</span>
    <span class=n>iidRep2</span> <span class=o>=</span> <span class=n>iDecode</span><span class=p>(</span><span class=n>qw</span><span class=p>,</span> <span class=n>iidRep</span><span class=p>,</span> <span class=n>rsep</span><span class=o>=</span><span class=s2>&quot; &quot;</span><span class=p>)</span>
    <span class=n>itemStyle</span> <span class=o>=</span> <span class=n>ViewDefs</span><span class=o>.</span><span class=n>itemStyle</span>
    <span class=n>tabLabels</span> <span class=o>=</span> <span class=n>ViewDefs</span><span class=o>.</span><span class=n>tabLabels</span>
    <span class=n>fileName</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&quot;</span><span class=si>{</span><span class=n>vr</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>itemStyle</span><span class=p>[</span><span class=n>qw</span><span class=p>][</span><span class=s1>&#39;t&#39;</span><span class=p>]</span><span class=si>}{</span><span class=n>iidRep2</span><span class=si>}</span><span class=s2>_</span><span class=si>{</span><span class=n>tabLabels</span><span class=p>[</span><span class=n>tp</span><span class=p>]</span><span class=si>}{</span><span class=n>extra</span><span class=si>}</span><span class=s2>.csv&quot;</span>
    <span class=p>(</span><span class=n>authorized</span><span class=p>,</span> <span class=n>msg</span><span class=p>)</span> <span class=o>=</span> <span class=n>Record</span><span class=o>.</span><span class=n>authRead</span><span class=p>(</span><span class=n>mr</span><span class=p>,</span> <span class=n>qw</span><span class=p>,</span> <span class=n>iidRep</span><span class=p>)</span>

    <span class=k>if</span> <span class=ow>not</span> <span class=n>authorized</span><span class=p>:</span>
        <span class=k>return</span> <span class=nb>dict</span><span class=p>(</span><span class=n>fileName</span><span class=o>=</span><span class=n>fileName</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>msg</span><span class=p>)</span>

    <span class=n>hebrewFields</span> <span class=o>=</span> <span class=n>Check</span><span class=o>.</span><span class=n>fields</span><span class=p>(</span><span class=n>tp</span><span class=p>,</span> <span class=n>qw</span><span class=o>=</span><span class=n>qw</span><span class=p>)</span>
    <span class=n>data</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>vr</span><span class=p>,</span> <span class=n>mr</span><span class=p>,</span> <span class=n>qw</span><span class=p>,</span> <span class=n>iid</span><span class=p>,</span> <span class=n>keywords</span><span class=p>,</span> <span class=n>tp</span><span class=p>,</span> <span class=n>extra</span><span class=p>,</span> <span class=n>hebrewFields</span><span class=p>,</span> <span class=n>fileName</span><span class=p>)</span>
    <span class=k>return</span> <span class=nb>dict</span><span class=p>(</span><span class=n>fileName</span><span class=o>=</span><span class=n>fileName</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> <div class="doc doc-object doc-function"> <h3 id=csvdata.csv class="doc doc-heading"> <code class="codehilite language-python"><span class=n>csv</span><span class=p>(</span><span class=n>data</span><span class=p>)</span></code> <a href=#csvdata.csv class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>converts an data structure of rows and fields into a csv string. With proper quotations and escapes</p> <details class=quote> <summary>Source code in <code>modules/csvdata.py</code></summary> <div class=codehilite><pre><span></span><code><span class=k>def</span> <span class=nf>csv</span><span class=p>(</span><span class=n>data</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;converts an data structure of rows and fields into a csv string.</span>
<span class=sd>    With proper quotations and escapes</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>result</span> <span class=o>=</span> <span class=p>[]</span>
    <span class=k>if</span> <span class=n>data</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
        <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>data</span><span class=p>:</span>
            <span class=n>prow</span> <span class=o>=</span> <span class=p>[</span><span class=nb>str</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>row</span><span class=p>]</span>
            <span class=n>trow</span> <span class=o>=</span> <span class=p>[</span>
                <span class=sa>f</span><span class=s1>&#39;&#39;&#39;&quot;</span><span class=si>{</span><span class=n>x</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;&quot;&#39;</span><span class=p>,</span> <span class=s1>&#39;&quot;&quot;&#39;</span><span class=p>)</span><span class=si>}</span><span class=s1>&quot;&#39;&#39;&#39;</span> <span class=k>if</span> <span class=s1>&#39;&quot;&#39;</span> <span class=ow>in</span> <span class=n>x</span> <span class=ow>or</span> <span class=s2>&quot;,&quot;</span> <span class=ow>in</span> <span class=n>x</span> <span class=k>else</span> <span class=n>x</span>
                <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>prow</span>
            <span class=p>]</span>
            <span class=n>result</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=s2>&quot;,&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>trow</span><span class=p>))</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot; &quot;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&quot;</span><span class=se>\r</span><span class=s2>&quot;</span><span class=p>,</span> <span class=s2>&quot; &quot;</span><span class=p>))</span>
    <span class=k>return</span> <span class=s2>&quot;</span><span class=se>\n</span><span class=s2>&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=dbconfig class="doc doc-heading"> <code>dbconfig</code> <a href=#dbconfig class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h3 id=dbconfig.CONFIG class="doc doc-heading"> <code class="codehilite language-python"><span class=n>CONFIG</span></code> <a href=#dbconfig.CONFIG class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Connection details for the databases.</p> </div> </div> <div class="doc doc-object doc-attribute"> <h3 id=dbconfig.EMDROS_VERSIONS class="doc doc-heading"> <code class="codehilite language-python"><span class=n>EMDROS_VERSIONS</span></code> <a href=#dbconfig.EMDROS_VERSIONS class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <p>Emdros versions that have been in use by SHEBANQ.</p> <p>Copied manually from /opt/emdros/include/emdros/version-emdros.h</p> </div> </div> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=helpers class="doc doc-heading"> <code>helpers</code> <a href=#helpers class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=materials class="doc doc-heading"> <code>materials</code> <a href=#materials class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=mql class="doc doc-heading"> <code>mql</code> <a href=#mql class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=note class="doc doc-heading"> <code>note</code> <a href=#note class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=notesave class="doc doc-heading"> <code>notesave</code> <a href=#notesave class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=notesupload class="doc doc-heading"> <code>notesupload</code> <a href=#notesupload class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=notetree class="doc doc-heading"> <code>notetree</code> <a href=#notetree class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=query class="doc doc-heading"> <code>query</code> <a href=#query class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h3 id=query.QUERY class="doc doc-heading"> <code> QUERY </code> <a href=#query.QUERY class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-method"> <h4 id=query.QUERY.getInfo class="doc doc-heading"> <code class="codehilite language-python"><span class=n>getInfo</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>showPrivateFields</span><span class=p>,</span> <span class=n>query_id</span><span class=p>,</span> <span class=n>vr</span><span class=p>,</span> <span class=n>msgs</span><span class=p>,</span> <span class=n>singleVersion</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>withIds</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>po</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span></code> <a href=#query.QUERY.getInfo class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>If called with singleVersion is True, we are grabbibg queries for the side list of a chapter. In this case: * query_id is an iterable of query ids * we only want the query exe records of these queries for a single version vr * we only want query records that are: * belong to a shared query * up to date: executed after modified</p> <details class=quote> <summary>Source code in <code>modules/query.py</code></summary> <div class=codehilite><pre><span></span><code><span class=k>def</span> <span class=nf>getInfo</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>showPrivateFields</span><span class=p>,</span>
    <span class=n>query_id</span><span class=p>,</span>
    <span class=n>vr</span><span class=p>,</span>
    <span class=n>msgs</span><span class=p>,</span>
    <span class=n>singleVersion</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
    <span class=n>withIds</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span>
    <span class=n>po</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
<span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    If called with singleVersion is True,</span>
<span class=sd>    we are grabbibg queries for the side list of a chapter.</span>
<span class=sd>    In this case:</span>
<span class=sd>    *   query_id is an iterable of query ids</span>
<span class=sd>    *   we only want the query exe records of these queries for a single version vr</span>
<span class=sd>    *   we only want query records that are:</span>
<span class=sd>        *   belong to a shared query</span>
<span class=sd>        *   up to date: executed after modified</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>db</span> <span class=o>=</span> <span class=n>current</span><span class=o>.</span><span class=n>db</span>

    <span class=n>sqli</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>dedent</span><span class=p>(</span>
            <span class=sd>&quot;&quot;&quot;,</span>
<span class=sd>            query.created_by as user_id,</span>
<span class=sd>            project.id as project_id,</span>
<span class=sd>            organization.id as org_id</span>
<span class=sd>            &quot;&quot;&quot;</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>withIds</span> <span class=ow>and</span> <span class=n>po</span>
        <span class=k>else</span> <span class=s2>&quot;&quot;</span>
    <span class=p>)</span>

    <span class=n>sqlx</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>dedent</span><span class=p>(</span>
            <span class=sd>&quot;&quot;&quot;,</span>
<span class=sd>            query_exe.id as query_exe_id,</span>
<span class=sd>            query_exe.mql as mql,</span>
<span class=sd>            query_exe.version as version,</span>
<span class=sd>            query_exe.eversion as eversion,</span>
<span class=sd>            query_exe.resultmonads as resultmonads,</span>
<span class=sd>            query_exe.results as results,</span>
<span class=sd>            query_exe.executed_on as executed_on,</span>
<span class=sd>            query_exe.modified_on as xmodified_on,</span>
<span class=sd>            query_exe.is_published as is_published,</span>
<span class=sd>            query_exe.published_on as published_on</span>
<span class=sd>            &quot;&quot;&quot;</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>singleVersion</span>
        <span class=k>else</span> <span class=s2>&quot;&quot;</span>
    <span class=p>)</span>

    <span class=n>sqlp</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>dedent</span><span class=p>(</span>
            <span class=sd>&quot;&quot;&quot;,</span>
<span class=sd>            project.name as project_name,</span>
<span class=sd>            project.website as project_website,</span>
<span class=sd>            organization.name as org_name,</span>
<span class=sd>            organization.website as org_website</span>
<span class=sd>            &quot;&quot;&quot;</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>po</span>
        <span class=k>else</span> <span class=s2>&quot;&quot;</span>
    <span class=p>)</span>

    <span class=n>sqlb</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>dedent</span><span class=p>(</span>
            <span class=sd>&quot;&quot;&quot;,</span>
<span class=sd>            auth_user.email as uemail</span>
<span class=sd>        &quot;&quot;&quot;</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>showPrivateFields</span>
        <span class=k>else</span> <span class=n>dedent</span><span class=p>(</span>
            <span class=sd>&quot;&quot;&quot;,</span>
<span class=sd>            &#39;n.n@not.disclosed&#39; as uemail</span>
<span class=sd>            &quot;&quot;&quot;</span>
        <span class=p>)</span>
    <span class=p>)</span>

    <span class=n>sqlm</span> <span class=o>=</span> <span class=n>dedent</span><span class=p>(</span>
        <span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
<span class=s2>        query.id as id,</span>
<span class=s2>        query.name as name,</span>
<span class=s2>        query.description as description,</span>
<span class=s2>        query.created_on as created_on,</span>
<span class=s2>        query.modified_on as modified_on,</span>
<span class=s2>        query.is_shared as is_shared,</span>
<span class=s2>        query.shared_on as shared_on,</span>
<span class=s2>        auth_user.first_name,</span>
<span class=s2>        auth_user.last_name</span>
<span class=s2>        </span><span class=si>{</span><span class=n>sqlb</span><span class=si>}{</span><span class=n>sqli</span><span class=si>}{</span><span class=n>sqlp</span><span class=si>}{</span><span class=n>sqlx</span><span class=si>}</span><span class=s2></span>
<span class=s2>        &quot;&quot;&quot;</span>
    <span class=p>)</span>

    <span class=n>sqlr</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>dedent</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
<span class=s2>            inner join query_exe</span>
<span class=s2>            on</span>
<span class=s2>                query_exe.query_id = query.id and</span>
<span class=s2>                query_exe.version = &#39;</span><span class=si>{</span><span class=n>vr</span><span class=si>}</span><span class=s2>&#39;</span>
<span class=s2>            &quot;&quot;&quot;</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>singleVersion</span>
        <span class=k>else</span> <span class=s2>&quot;&quot;</span>
    <span class=p>)</span>

    <span class=n>sqlpr</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>dedent</span><span class=p>(</span>
            <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            inner join organization on query.organization = organization.id</span>
<span class=sd>            inner join project on query.project = project.id</span>
<span class=sd>            &quot;&quot;&quot;</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>po</span>
        <span class=k>else</span> <span class=s2>&quot;&quot;</span>
    <span class=p>)</span>

    <span class=n>sqlc</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>dedent</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
<span class=s2>            where query.id in (</span><span class=si>{</span><span class=s2>&quot;,&quot;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>query_id</span><span class=p>)</span><span class=si>}</span><span class=s2>)</span>
<span class=s2>            and query.is_shared = &#39;T&#39;</span>
<span class=s2>            and query_exe.executed_on &gt;= query_exe.modified_on</span>
<span class=s2>        &quot;&quot;&quot;</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>singleVersion</span>
        <span class=k>else</span> <span class=n>dedent</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
<span class=s2>            where query.id = </span><span class=si>{</span><span class=n>query_id</span><span class=si>}</span><span class=s2></span>
<span class=s2>            &quot;&quot;&quot;</span>
        <span class=p>)</span>
    <span class=p>)</span>

    <span class=n>sqlo</span> <span class=o>=</span> <span class=p>(</span>
        <span class=n>dedent</span><span class=p>(</span>
            <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            order by auth_user.last_name, query.name</span>
<span class=sd>            &quot;&quot;&quot;</span>
        <span class=p>)</span>
        <span class=k>if</span> <span class=n>singleVersion</span>
        <span class=k>else</span> <span class=s2>&quot;&quot;</span>
    <span class=p>)</span>

    <span class=n>sql</span> <span class=o>=</span> <span class=n>dedent</span><span class=p>(</span>
        <span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
<span class=s2>        select</span><span class=si>{</span><span class=n>sqlm</span><span class=si>}</span><span class=s2> from query</span>
<span class=s2>        inner join auth_user</span>
<span class=s2>        on query.created_by = auth_user.id</span>
<span class=s2>        </span><span class=si>{</span><span class=n>sqlr</span><span class=si>}{</span><span class=n>sqlpr</span><span class=si>}{</span><span class=n>sqlc</span><span class=si>}{</span><span class=n>sqlo</span><span class=si>}</span><span class=s2></span>
<span class=s2>        ;</span>
<span class=s2>        &quot;&quot;&quot;</span>
    <span class=p>)</span>
    <span class=n>records</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>executesql</span><span class=p>(</span><span class=n>sql</span><span class=p>,</span> <span class=n>as_dict</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=k>if</span> <span class=n>records</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>msgs</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=s2>&quot;error&quot;</span><span class=p>,</span> <span class=s2>&quot;Cannot lookup query(ies)&quot;</span><span class=p>))</span>
        <span class=k>return</span> <span class=kc>None</span>
    <span class=k>if</span> <span class=n>singleVersion</span><span class=p>:</span>
        <span class=k>for</span> <span class=n>record</span> <span class=ow>in</span> <span class=n>records</span><span class=p>:</span>
            <span class=bp>self</span><span class=o>.</span><span class=n>getFields</span><span class=p>(</span><span class=n>vr</span><span class=p>,</span> <span class=n>record</span><span class=p>,</span> <span class=p>[],</span> <span class=n>singleVersion</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>records</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>records</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
            <span class=n>msgs</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=s2>&quot;error&quot;</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;No query with id </span><span class=si>{</span><span class=n>query_id</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>))</span>
            <span class=k>return</span> <span class=kc>None</span>
        <span class=n>record</span> <span class=o>=</span> <span class=n>records</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
        <span class=n>record</span><span class=p>[</span><span class=s2>&quot;description_md&quot;</span><span class=p>]</span> <span class=o>=</span> <span class=n>markdown</span><span class=p>(</span>
            <span class=n>record</span><span class=p>[</span><span class=s2>&quot;description&quot;</span><span class=p>]</span> <span class=ow>or</span> <span class=s2>&quot;&quot;</span><span class=p>,</span> <span class=n>output_format</span><span class=o>=</span><span class=s2>&quot;xhtml5&quot;</span>
        <span class=p>)</span>
        <span class=n>sql</span> <span class=o>=</span> <span class=n>dedent</span><span class=p>(</span>
            <span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
<span class=s2>            select</span>
<span class=s2>                id as query_exe_id,</span>
<span class=s2>                mql,</span>
<span class=s2>                version,</span>
<span class=s2>                eversion,</span>
<span class=s2>                resultmonads,</span>
<span class=s2>                results,</span>
<span class=s2>                executed_on,</span>
<span class=s2>                modified_on as xmodified_on,</span>
<span class=s2>                is_published,</span>
<span class=s2>                published_on</span>
<span class=s2>            from query_exe</span>
<span class=s2>            where query_id = </span><span class=si>{</span><span class=n>query_id</span><span class=si>}</span><span class=s2></span>
<span class=s2>            ;</span>
<span class=s2>            &quot;&quot;&quot;</span>
        <span class=p>)</span>
        <span class=n>recordsExe</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>executesql</span><span class=p>(</span><span class=n>sql</span><span class=p>,</span> <span class=n>as_dict</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
        <span class=bp>self</span><span class=o>.</span><span class=n>getFields</span><span class=p>(</span><span class=n>vr</span><span class=p>,</span> <span class=n>record</span><span class=p>,</span> <span class=n>recordsExe</span><span class=p>,</span> <span class=n>singleVersion</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
        <span class=k>return</span> <span class=n>record</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=querychapter class="doc doc-heading"> <code>querychapter</code> <a href=#querychapter class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h3 id=querychapter.QUERYCHAPTER class="doc doc-heading"> <code> QUERYCHAPTER </code> <a href=#querychapter.QUERYCHAPTER class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-method"> <h4 id=querychapter.QUERYCHAPTER.updateQCindex class="doc doc-heading"> <code class="codehilite language-python"><span class=n>updateQCindex</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vr</span><span class=p>,</span> <span class=n>query_id</span><span class=p>,</span> <span class=n>uptodate</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span></code> <a href=#querychapter.QUERYCHAPTER.updateQCindex class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>We want an up to date mapping from chapters to the shared, up-to-date queries with results in those chapters.</p> <p>We call this function when: * a query has run and a niew set of slots has been stored. * the sharing status of a query changes</p> <p>We do not call this function when: * the published state of a query has changed (see updatePubStatus) * when a query body is edited but not run (see below).</p> <p>In those cases the following will be taken care of:</p> <p>First delete the query from the index. If the query is shared and up to date, we add it back to the index based on its results.</p> <p>However, this function might be called at a time that the results of the query have been stored in the database, before the metadata has arrived there. In that case we can not test on the uptodateness, so we assume that the caller has passed uptodate=True. Indeed, when the sharing status has changed, we are able to perform this test, and then there is no need to pass uptodate=True.</p> <p>What if a query body is edited but not run? It will then become outdated, and should be removed from the index. But that is a rather costly operation, and it is likely that a query is edited many times before it is run again. What we do instead is, that when we fetch queries for the sidebar of a chapter, we skip the ones that are outdated.</p> <details class=quote> <summary>Source code in <code>modules/querychapter.py</code></summary> <div class=codehilite><pre><span></span><code><span class=k>def</span> <span class=nf>updateQCindex</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vr</span><span class=p>,</span> <span class=n>query_id</span><span class=p>,</span> <span class=n>uptodate</span><span class=o>=</span><span class=kc>True</span><span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>    We want an up to date mapping from chapters to the shared, up-to-date</span>
<span class=sd>    queries with results in those chapters.</span>

<span class=sd>    We call this function when:</span>
<span class=sd>    *   a query has run and a niew set of slots has been stored.</span>
<span class=sd>    *   the sharing status of a query changes</span>

<span class=sd>    We do not call this function when:</span>
<span class=sd>    *   the published state of a query has changed (see updatePubStatus)</span>
<span class=sd>    *   when a query body is edited but not run (see below).</span>

<span class=sd>    In those cases the following will be taken care of:</span>

<span class=sd>    First delete the query from the index.</span>
<span class=sd>    If the query is shared and up to date, we add it back to the index</span>
<span class=sd>    based on its results.</span>

<span class=sd>    However, this function might be called at a time that the results</span>
<span class=sd>    of the query have been stored in the database, before the metadata</span>
<span class=sd>    has arrived there.</span>
<span class=sd>    In that case we can not test on the uptodateness, so we assume that the</span>
<span class=sd>    caller has passed uptodate=True.</span>
<span class=sd>    Indeed, when the sharing status has changed, we are able to perform</span>
<span class=sd>    this test, and then there is no need to pass uptodate=True.</span>


<span class=sd>    What if a query body is edited but not run? It will then become outdated,</span>
<span class=sd>    and should be removed from the index.</span>
<span class=sd>    But that is a rather costly operation, and it is likely that a query is edited</span>
<span class=sd>    many times before it is run again.</span>
<span class=sd>    What we do instead is, that when we fetch queries for the sidebar of a chapter,</span>
<span class=sd>    we skip the ones that are outdated.</span>
<span class=sd>    &quot;&quot;&quot;</span>
    <span class=n>Caching</span> <span class=o>=</span> <span class=n>current</span><span class=o>.</span><span class=n>Caching</span>
    <span class=n>db</span> <span class=o>=</span> <span class=n>current</span><span class=o>.</span><span class=n>db</span>

    <span class=n>debug</span><span class=p>((</span><span class=sa>f</span><span class=s2>&quot;o-o-o updating chapter-query index for data </span><span class=si>{</span><span class=n>vr</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>))</span>
    <span class=n>startTime</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>

    <span class=n>chaptersFromQuery</span> <span class=o>=</span> <span class=n>Caching</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
        <span class=sa>f</span><span class=s2>&quot;chaptersFromQuery_</span><span class=si>{</span><span class=n>vr</span><span class=si>}</span><span class=s2>_&quot;</span><span class=p>,</span>
        <span class=k>lambda</span><span class=p>:</span> <span class=p>{},</span>
        <span class=kc>None</span><span class=p>,</span>
    <span class=p>)</span>
    <span class=n>queriesFromChapter</span> <span class=o>=</span> <span class=n>Caching</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
        <span class=sa>f</span><span class=s2>&quot;queriesFromChapter_</span><span class=si>{</span><span class=n>vr</span><span class=si>}</span><span class=s2>_&quot;</span><span class=p>,</span>
        <span class=k>lambda</span><span class=p>:</span> <span class=p>{},</span>
        <span class=kc>None</span><span class=p>,</span>
    <span class=p>)</span>
    <span class=c1># remove query_id from both indexes: chaptersFromQuery and queriesFromChapter</span>
    <span class=k>if</span> <span class=n>query_id</span> <span class=ow>in</span> <span class=n>chaptersFromQuery</span><span class=p>:</span>
        <span class=n>theseChapters</span> <span class=o>=</span> <span class=n>chaptersFromQuery</span><span class=p>[</span><span class=n>query_id</span><span class=p>]</span>
        <span class=k>for</span> <span class=n>chapter_id</span> <span class=ow>in</span> <span class=n>theseChapters</span><span class=p>:</span>
            <span class=k>if</span> <span class=n>chapter_id</span> <span class=ow>in</span> <span class=n>queriesFromChapter</span><span class=p>:</span>
                <span class=k>if</span> <span class=n>query_id</span> <span class=ow>in</span> <span class=n>queriesFromChapter</span><span class=p>[</span><span class=n>chapter_id</span><span class=p>]:</span>
                    <span class=k>del</span> <span class=n>queriesFromChapter</span><span class=p>[</span><span class=n>chapter_id</span><span class=p>][</span><span class=n>query_id</span><span class=p>]</span>
                <span class=k>if</span> <span class=ow>not</span> <span class=n>queriesFromChapter</span><span class=p>[</span><span class=n>chapter_id</span><span class=p>]:</span>
                    <span class=k>del</span> <span class=n>queriesFromChapter</span><span class=p>[</span><span class=n>chapter_id</span><span class=p>]</span>
        <span class=k>del</span> <span class=n>chaptersFromQuery</span><span class=p>[</span><span class=n>query_id</span><span class=p>]</span>

    <span class=c1># add query_id again to both indexes (but now with updated results)</span>
    <span class=n>uptodateSQL</span> <span class=o>=</span> <span class=p>(</span>
        <span class=s2>&quot;&quot;</span>
        <span class=k>if</span> <span class=n>uptodate</span>
        <span class=k>else</span> <span class=n>dedent</span><span class=p>(</span>
            <span class=sd>&quot;&quot;&quot;</span>
<span class=sd>            and</span>
<span class=sd>                query_exe.executed_on &gt;= query_exe.modified_on</span>
<span class=sd>            &quot;&quot;&quot;</span>
        <span class=p>)</span>
    <span class=p>)</span>
    <span class=n>resultSQL1</span> <span class=o>=</span> <span class=n>dedent</span><span class=p>(</span>
        <span class=sa>f</span><span class=s2>&quot;&quot;&quot;</span>
<span class=s2>        select</span>
<span class=s2>            query_exe.id, query.id</span>
<span class=s2>        from query</span>
<span class=s2>        inner join query_exe on</span>
<span class=s2>            query.id = query_exe.query_id</span>
<span class=s2>        where</span>
<span class=s2>            query.id = </span><span class=si>{</span><span class=n>query_id</span><span class=si>}</span><span class=s2></span>
<span class=s2>        and</span>
<span class=s2>            query_exe.version = &#39;</span><span class=si>{</span><span class=n>vr</span><span class=si>}</span><span class=s2>&#39;</span>
<span class=s2>        and</span>
<span class=s2>            query.is_shared = &#39;T&#39;</span>
<span class=s2>        </span><span class=si>{</span><span class=n>uptodateSQL</span><span class=si>}</span><span class=s2></span>
<span class=s2>        ;</span>
<span class=s2>        &quot;&quot;&quot;</span>
    <span class=p>)</span>
    <span class=n>queryTime</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
    <span class=n>results1</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>executesql</span><span class=p>(</span><span class=n>resultSQL1</span><span class=p>)</span>
    <span class=n>queryTime</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>queryTime</span>
    <span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;      found </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>results1</span><span class=p>)</span><span class=si>}</span><span class=s2> shared queries in </span><span class=si>{</span><span class=n>delta</span><span class=p>(</span><span class=n>queryTime</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>

    <span class=n>queryFromExe</span> <span class=o>=</span> <span class=p>{}</span>
    <span class=k>for</span> <span class=p>(</span><span class=n>query_exe_id</span><span class=p>,</span> <span class=n>query_id</span><span class=p>)</span> <span class=ow>in</span> <span class=n>results1</span><span class=p>:</span>
        <span class=n>queryFromExe</span><span class=p>[</span><span class=n>query_exe_id</span><span class=p>]</span> <span class=o>=</span> <span class=n>query_id</span>

    <span class=k>if</span> <span class=n>queryFromExe</span><span class=p>:</span>
        <span class=n>doQueryIndex</span><span class=p>(</span><span class=n>db</span><span class=p>,</span> <span class=n>vr</span><span class=p>,</span> <span class=n>queryFromExe</span><span class=p>)</span>

    <span class=n>exe</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span> <span class=o>-</span> <span class=n>startTime</span>
    <span class=n>debug</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;o-o-o updated chapter-query index for data </span><span class=si>{</span><span class=n>vr</span><span class=si>}</span><span class=s2> in </span><span class=si>{</span><span class=n>delta</span><span class=p>(</span><span class=n>exe</span><span class=p>)</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=queryrecent class="doc doc-heading"> <code>queryrecent</code> <a href=#queryrecent class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=querysave class="doc doc-heading"> <code>querysave</code> <a href=#querysave class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=querytree class="doc doc-heading"> <code>querytree</code> <a href=#querytree class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=record class="doc doc-heading"> <code>record</code> <a href=#record class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=side class="doc doc-heading"> <code>side</code> <a href=#side class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=test class="doc doc-heading"> <code>test</code> <a href=#test class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=urls class="doc doc-heading"> <code>urls</code> <a href=#urls class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=versecontent class="doc doc-heading"> <code>versecontent</code> <a href=#versecontent class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h3 id=versecontent.VerseContent class="doc doc-heading"> <code> VerseContent </code> <a href=#versecontent.VerseContent class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-method"> <h4 id=versecontent.VerseContent.__init__ class="doc doc-heading"> <code class="codehilite language-python"><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vr</span><span class=p>,</span> <span class=n>book_name</span><span class=p>,</span> <span class=n>chapter_num</span><span class=p>,</span> <span class=n>verse_num</span><span class=p>,</span> <span class=n>xml</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>wordData</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>tp</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>tr</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>mr</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>lang</span><span class=o>=</span><span class=s1>&#39;en&#39;</span><span class=p>)</span></code> <span class="doc doc-properties"> <small class="doc doc-property doc-property-special"><code>special</code></small> </span> <a href=#versecontent.VerseContent.__init__ class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>Handle a single verse.</p> <p>It can retrieve word data from the database and render it in various textual formats.</p> <details class=quote> <summary>Source code in <code>modules/versecontent.py</code></summary> <div class=codehilite><pre><span></span><code><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>vr</span><span class=p>,</span>
    <span class=n>book_name</span><span class=p>,</span>
    <span class=n>chapter_num</span><span class=p>,</span>
    <span class=n>verse_num</span><span class=p>,</span>
    <span class=n>xml</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>wordData</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>tp</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>tr</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>mr</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>lang</span><span class=o>=</span><span class=s2>&quot;en&quot;</span><span class=p>,</span>
<span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;Handle a single verse.</span>

<span class=sd>    It can retrieve word data from the database</span>
<span class=sd>    and render it in various textual formats.</span>
<span class=sd>    &quot;&quot;&quot;</span>

    <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=n>vr</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>tp</span> <span class=o>=</span> <span class=n>tp</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>tr</span> <span class=o>=</span> <span class=n>tr</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>mr</span> <span class=o>=</span> <span class=n>mr</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>lang</span> <span class=o>=</span> <span class=n>lang</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>book_name</span> <span class=o>=</span> <span class=n>book_name</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>chapter_num</span> <span class=o>=</span> <span class=n>chapter_num</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>verse_num</span> <span class=o>=</span> <span class=n>verse_num</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>xml</span> <span class=o>=</span> <span class=n>xml</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>wordData</span> <span class=o>=</span> <span class=n>wordData</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=verses class="doc doc-heading"> <code>verses</code> <a href=#verses class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=versescontent class="doc doc-heading"> <code>versescontent</code> <a href=#versescontent class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h3 id=versescontent.VersesContent class="doc doc-heading"> <code> VersesContent </code> <a href=#versescontent.VersesContent class=headerlink title="Permanent link">&para;</a></h3> <div class="doc doc-contents "> <div class="doc doc-children"> <div class="doc doc-object doc-method"> <h4 id=versescontent.VersesContent.__init__ class="doc doc-heading"> <code class="codehilite language-python"><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>vr</span><span class=p>,</span> <span class=n>mr</span><span class=p>,</span> <span class=n>verseIds</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>chapter</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>tp</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>tr</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>lang</span><span class=o>=</span><span class=s1>&#39;en&#39;</span><span class=p>)</span></code> <span class="doc doc-properties"> <small class="doc doc-property doc-property-special"><code>special</code></small> </span> <a href=#versescontent.VersesContent.__init__ class=headerlink title="Permanent link">&para;</a></h4> <div class="doc doc-contents "> <p>my docs</p> <details class=quote> <summary>Source code in <code>modules/versescontent.py</code></summary> <div class=codehilite><pre><span></span><code><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span>
    <span class=bp>self</span><span class=p>,</span>
    <span class=n>vr</span><span class=p>,</span>
    <span class=n>mr</span><span class=p>,</span>
    <span class=n>verseIds</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>chapter</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>tp</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>tr</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
    <span class=n>lang</span><span class=o>=</span><span class=s2>&quot;en&quot;</span><span class=p>,</span>
<span class=p>):</span>
    <span class=sd>&quot;&quot;&quot;my docs&quot;&quot;&quot;</span>
    <span class=k>if</span> <span class=n>tr</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
        <span class=n>tr</span> <span class=o>=</span> <span class=s2>&quot;hb&quot;</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>version</span> <span class=o>=</span> <span class=n>vr</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>mr</span> <span class=o>=</span> <span class=n>mr</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>tp</span> <span class=o>=</span> <span class=n>tp</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>tr</span> <span class=o>=</span> <span class=n>tr</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>lang</span> <span class=o>=</span> <span class=n>lang</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>chapter</span> <span class=o>=</span> <span class=n>chapter</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>verseIds</span> <span class=o>=</span> <span class=n>verseIds</span>
    <span class=bp>self</span><span class=o>.</span><span class=n>process</span><span class=p>()</span>
</code></pre></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=viewdefs class="doc doc-heading"> <code>viewdefs</code> <a href=#viewdefs class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=viewsettings class="doc doc-heading"> <code>viewsettings</code> <a href=#viewsettings class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> </div> </div> </div> <hr> <div class="doc doc-object doc-module"> <h2 id=word class="doc doc-heading"> <code>word</code> <a href=#word class=headerlink title="Permanent link">&para;</a></h2> <div class="doc doc-contents first"> <div class="doc doc-children"> </div> </div> </div> <p>--</p> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../controllers/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Controllers" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> Controllers </div> </div> </a> <a href=../views/ class="md-footer__link md-footer__link--next" aria-label="Next: Views" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> Views </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script> <script src=../../assets/javascripts/bundle.febc23d1.min.js></script> </body> </html>