{{ left_sidebar_enabled = True }}
{{ extend 'layout.html' }}

{{ block head }}
    <link type="text/css" rel="stylesheet" href="{{=URL('static', 'css/passage.css')}}" />
    {{ if monads: }}
        <script type="text/javascript">
            // This is necessary to pass on the information in a web2py
            // controller variable to javascript.
            var w2p_monads = {{ =XML(response.json(monads)) }};
        </script>
    {{ pass }}
    <script src="{{=URL('static', 'js/passage.js')}}"></script>
{{ end }}

{{ include 'passage/browser_form.html' }}

{{
    ua = request.user_agent().browser.name
    replace_set = {0x059C,0x05A8,0x05BD,0x05A9,0x0594,0x05A4,0x05B4,0x05B1,0x05A5,0x05A0,0x05A9,0x059D,0x0598,0x05B0,0x05BD,0x05B7,0x0595,0x059F,0x05B3,0x059B,0x05B2,0x05AD,0x05BB,0x05B6,0x05C4,0x05B8,0x0599,0x05AE,0x05A3,0x05C5,0x05B5,0x05A1,0x0591,0x0596,0x0593,0x05AF,0x05AB,0x05AC,0x059A,0x05A6,0x05BF,0x05AA,0x05A8,0x05A7,0x05A0,0x0597,0x059E,0x05BD}
    def adapted_text(text): return text
}}
{{
    #if ua == 'Safari' or ua == 'Chrome':
    if ua == 'Chrome':
        def adapted_text(text):
            return XML('' if text == '' else (text + ('&nbsp;' if ord(text[-1]) in replace_set else '')))
}}
{{pass}}

{{ if verses: }}
    <dl id="verses">
    {{ for verse in verses:}}
        <dt>{{ =verse.verse_num }}</dt>
        <dd>{{
                for word in verse.get_words():
                    atext = adapted_text(word.text)
                }}<span m="{{=word.monad_id}}" class={{="highlight" if word.focus else "word"}}>{{=atext}}</span>{{=word.trailer}}{{pass}}
        </dd>
    {{ pass }}
    </dl>
{{ pass }}


{{ block left_sidebar }}
    <!--{{ include 'passage/highlight_form.html' }}
    <p>or</p>
    {{ =verse_word_highlighter_form }}
    <p>or</p>-->
    {{ include 'passage/query_form.html' }}
{{ end }}
