{{ left_sidebar_enabled = True }}
{{ extend 'layout.html' }}

{{ block head }}
    <link type="text/css" rel="stylesheet" href="{{=URL('static', 'css/passage.css')}}" />
    {{ if monads: }}
        <script type="text/javascript">
            // This is necessary to pass on the information in a web2py
            // controller variable to javascript.
            var w2p_monads = {{ =XML(response.json(monads)) }};
        </script>
    {{ pass }}
    <script src="{{=URL('static', 'js/passage.js')}}"></script>
{{ end }}

{{ include 'passage/browser_form.html' }}

{{
    ua = request.user_agent().browser.name
    #adapt = ua == 'Safari' or ua == 'Chrome'
    adapt = ua == 'Safari'
    rpat = re.compile(u'(?P<last>[\u059C\u05A8\u05BD\u05A9\u0594\u05A4\u05B4\u05B1\u05A5\u05A0\u05A9\u059D\u0598\u05B0\u05BD\u05B7\u0595\u059F\u05B3\u059B\u05B2\u05AD\u05BB\u05B6\u05C4\u05B8\u0599\u05AE\u05A3\u05C5\u05B5\u05A1\u0591\u0596\u0593\u05AF\u05AB\u05AC\u059A\u05A6\u05BF\u05AA\u05A8\u05A7\u05A0\u0597\u059E\u05BD])<', flags=re.U)
}}

{{ if verses: }}
    <dl id="verses">
    {{ for verse in verses:
        if adapt:
            ht = rpat.sub(u'\g<last>&nbsp;<', unicode(verse.html, encoding="utf-8"))
        else:
            ht = verse.html
    }}{{pass}}
        <dt>{{ =verse.verse_num }}</dt>
        <dd>{{ =XML(ht) }}</dd>
    {{ pass }}
    </dl>
{{ pass }}


{{ block left_sidebar }}
    <!--{{ include 'passage/highlight_form.html' }}
    <p>or</p>
    {{ =verse_word_highlighter_form }}
    <p>or</p>-->
    {{ include 'passage/query_form.html' }}
{{ end }}
