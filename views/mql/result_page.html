{{if exception is not None:}}
    <div class="exception">
        <div>The error message is printed below.</div>
        <div>
            {{=exception_message}}
        </div>
        <div>Remote exception:</div>
        {{=exception}}
     </div>
{{else:}}
    {{
        ua = request.user_agent().browser.name
    }}
    <script type="text/javascript">
var save_url = "{{=URL('default', 'save_var')}}"
var view_url = "{{=XML(URL(vars=request.vars, host=True))}}"
    </script>
    <script src="{{=URL('static', 'js/rhtext_def.js')}}"></script>
    <script src="{{=URL('static', 'js/passage.js')}}"></script>
{{verses = verse_data}}
                <div>
{{if page == 0:}}
                    <p>No results retrieved yet</p>
{{else:}}
                    <p>Page {{=page}} of {{=pages}} with {{=results}} verse{{='s' if results != 1 else ''}}</p>
{{pass}}
{{if verses != None:}}
    {{=XML(verses.legend(request, response))}}
{{pass}}
                </div>
                <div class="monad_sets qresults" id="qresults">
                    {{if verses != None:}}
                        {{for verse in verses.verses:
                            (book, chapter) = verse.chapter_link()
                        }}
                            <div class="book-title">{{=A(
                                verse.citation_ref(),
                                _href=URL('passage', 'browser', vars=dict(book=book, chapter=chapter, get_queries=True))
                            )}}</div>
                            <div class="txt_p">{{=XML(verse.plain_text(ua))}}</div>
                            <div class="txt_il">{{=XML(verse.rich_text(ua))}}</div>
                        {{pass}}
                    {{pass}}
                </div>
                <div class="pagination">
                    <ul>
                    {{if page <= 1:}}
                        <li class="disabled"><a>«</a></li>
                    {{else:}}
                        <li>{{=A('«', callback=URL('mql', 'result_page', vars=dict(id=qid, page=page-1)), target='rlist')}}</li>
                    {{pass}}

                    {{ 
                        for p in pagelist:
                    }} 
                    {{if page == p:}}
                        <li class="active"><a>{{=p}}</a></li>
                    {{else:}}
                        <li>{{=A(str(p), callback=URL('mql', 'result_page', vars=dict(id=qid, page=p)), target='rlist')}}</li>
                    {{pass}}
                    {{pass}}

                    {{if page >= pages:}}
                        <li class="disabled"><a>»</a></li>
                    {{else:}}
                        <li>{{=A('»', callback=URL('mql', 'result_page', vars=dict(id=qid, page=page+1)), target='rlist')}}</li>
                    {{pass}}
                    </ul>
                </div>
{{if verses != None:}}
                <script type="text/javascript">{{=XML(verses.adjust_data_view())}}</script>
                <script type="text/javascript">add_highlights('{{=verses.hl_query}}')</script>
{{pass}}
{{pass}}

{{include 'mql/window_adjust.html'}}
