{{if exception is not None:}}
    <div class="exception">
        <div>The error message is printed below.</div>
        <div>
            {{=exception_message}}
        </div>
        <div>Remote exception:</div>
        {{=exception}}
     </div>
{{else:}}
    {{
        ua = request.user_agent().browser.name
        replace_set = {0x059C,0x05A8,0x05BD,0x05A9,0x0594,0x05A4,0x05B4,0x05B1,0x05A5,0x05A0,0x05A9,0x059D,0x0598,0x05B0,0x05BD,0x05B7,0x0595,0x059F,0x05B3,0x059B,0x05B2,0x05AD,0x05BB,0x05B6,0x05C4,0x05B8,0x0599,0x05AE,0x05A3,0x05C5,0x05B5,0x05A1,0x0591,0x0596,0x0593,0x05AF,0x05AB,0x05AC,0x059A,0x05A6,0x05BF,0x05AA,0x05A8,0x05A7,0x05A0,0x0597,0x059E,0x05BD}
        def adapted_text(text): return text
    }}
    {{
        if ua == 'Safari' or ua == 'Chrome':
            def adapted_text(text):
                return XML('' if text == '' else (text + ('&nbsp;' if ord(text[-1]) in replace_set else '')))
    }}
    {{pass}}
                <div>
                    <p>{{if page == 0:}}No results retrieved yet{{else:}}Page {{=page}} of {{=pages}} with {{=results}} results{{pass}}.</p>
                </div>
                <div class="monad_sets qresults" id="qresults">
                    {{verses = verse_data}}
                    {{for verse in verses:
                        (book, chapter) = verse.chapter_link()
                    }}
                        <div class="book-title">{{=A(
                            verse.citation_ref(),
                            _target='_blank', _href=URL('passage', 'browser', vars=dict(book=book, chapter=chapter, get_queries=True))
                        )}}</div>
                        <div class="hebrew">{{
                            for word in verse.get_words():
                                atext = adapted_text(word.text)
                        }}{{if word.focus:}}<span class="focus">{{=atext}}</span>{{else:}}<span class="word">{{=atext}}</span>{{pass}}{{=word.trailer}}{{pass}}</div>
                    {{pass}}
                </div>
                <div class="pagination">
                    <ul>
                    {{if page <= 1:}}
                        <li class="disabled"><a>«</a></li>
                    {{else:}}
                        <li>{{=A('«', callback=URL('mql', 'result_page', vars=dict(id=qid, page=page-1)), target='rlist')}}</li>
                    {{pass}}

                    {{ 
                        for p in pagelist:
                    }} 
                    {{if page == p:}}
                        <li class="active"><a>{{=p}}</a></li>
                    {{else:}}
                        <li>{{=A(str(p), callback=URL('mql', 'result_page', vars=dict(id=qid, page=p)), target='rlist')}}</li>
                    {{pass}}
                    {{pass}}

                    {{if page >= pages:}}
                        <li class="disabled"><a>»</a></li>
                    {{else:}}
                        <li>{{=A('»', callback=URL('mql', 'result_page', vars=dict(id=qid, page=page+1)), target='rlist')}}</li>
                    {{pass}}
                    </ul>
                </div>
{{pass}}

{{include 'mql/window_adjust.html'}}
