<div class="mql_form" id="mform">
{{if edit:}}
    {{=form}}
{{else:}}
    <h2>{{=query.name}}</h2>
    <p>{{=query.description}}</p>
    <code>{{=query.mql}}</code>
    <p><i>Created by</i> <b>{{=person.first_name}} {{=person.last_name}}</b>, .</b></p>
    <p><i>Created on</i> {{=query.created_on}} by <b>{{=person.first_name}} {{=person.last_name}}</b>,
    affiliated with <a target="_blank" href="{{=organization.website}}">{{=organization.name}}</a>,
    for project <a target="_blank" href="{{=project.website}}">{{=project.name}}</a>.</p>
    <p><i>Modified on</i>: {{=query.modified_on}}. 
    <p><i>Executed on</i>: {{=query.executed_on}}. 
    <p>{{if query.is_published:}}<b>Public</b>{{else:}}Private{{pass}}</p>
{{pass}}
</div>

<div>
    <p>
    {{if not query.executed_on:}}<span class='warning'>This query needs to be executed.</span>
    {{elif query.executed_on < query.modified_on:}}<span class='error'>The stored query results are outdated.</span>
    {{else:}}<span class='info'>The stored query results are up to date.</span>
    {{if edit and not query.is_published == True:}}
        {{=A('[Publish Query]', callback=URL('mql', 'publish_query', vars=dict(id=qid)), target='top')}}
    {{pass}}
    {{pass}}
    {{if edit:}}
        {{=A('[Execute Query]', callback=URL('mql', 'execute_query', vars=dict(id=qid)), target='top')}}
    {{pass}}
    {{=A('[Show Results]', callback=URL('mql', 'result_page', vars=dict(id=qid, page=1)), target='rlist')}}
    </p>
</div>

<div id='rlist'>
    {{include 'mql/result_page.html'}}
</div>

{{include 'mql/window_adjust.html'}}
